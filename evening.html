<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Photo Card Generator - AHSAN | PKV - Evening</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
--primary-color: #1a365d;
--primary-light: #2c5282;
--primary-gradient: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
--secondary-color: #2d3748;
--secondary-light: #4a5568;
--secondary-gradient: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
--accent-color: #3182ce;
--accent-light: #63b3ed;
--accent-gradient: linear-gradient(135deg, #3182ce 0%, #63b3ed 100%);
--success-color: #38a169;
--success-light: #68d391;
--success-gradient: linear-gradient(135deg, #38a169 0%, #68d391 100%);
--warning-color: #d69e2e;
--warning-light: #f6e05e;
--warning-gradient: linear-gradient(135deg, #d69e2e 0%, #f6e05e 100%);
--info-color: #805ad5;
--info-light: #b794f4;
--info-gradient: linear-gradient(135deg, #805ad5 0%, #b794f4 100%);
--danger-color: #e53e3e;
--danger-light: #fc8181;
--danger-gradient: linear-gradient(135deg, #e53e3e 0%, #fc8181 100%);
--glass-bg: rgba(255, 255, 255, 0.1);
--glass-border: rgba(255, 255, 255, 0.2);
--shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
--shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
--shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
--shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.15);
--shadow-2xl: 0 25px 50px rgba(0, 0, 0, 0.25);
--text-primary: #1a202c;
--text-secondary: #2d3748;
--text-muted: #4a5568;
--bg-primary: #ffffff;
--bg-secondary: #f7fafc;
--bg-tertiary: #edf2f7;
--border-color: #e2e8f0;
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
background: linear-gradient(135deg, #1a365d 0%, #2c5282 50%, #3182ce 100%);
background-attachment: fixed;
min-height: 100vh;
padding: 20px;
position: relative;
overflow-x: hidden;
}

body::before {
content: '';
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23ffffff" fill-opacity="0.03"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
pointer-events: none;
z-index: 1;
}

.container {
max-width: 1400px;
margin: 0 auto;
position: relative;
z-index: 2;
}

.header {
text-align: center;
margin-bottom: 40px;
position: relative;
}

.header-content {
background: var(--glass-bg);
backdrop-filter: blur(20px);
-webkit-backdrop-filter: blur(20px);
border-radius: 30px;
border: 1px solid var(--glass-border);
padding: 40px;
box-shadow: var(--shadow-2xl);
position: relative;
overflow: hidden;
}

.header-content::before {
content: '';
position: absolute;
top: -50%;
left: -50%;
width: 200%;
height: 200%;
background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
animation: float 20s ease-in-out infinite;
}

@keyframes float {
0%, 100% { transform: translate(0, 0) rotate(0deg); }
33% { transform: translate(30px, -30px) rotate(120deg); }
66% { transform: translate(-20px, 20px) rotate(240deg); }
}

.home-btn {
position: absolute;
left: 30px;
top: 50%;
transform: translateY(-50%);
background: rgba(255, 255, 255, 0.2);
backdrop-filter: blur(10px);
-webkit-backdrop-filter: blur(10px);
border: 1px solid rgba(255, 255, 255, 0.3);
color: white;
width: 56px;
height: 56px;
border-radius: 20px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
box-shadow: var(--shadow-lg);
}

.home-btn:hover {
background: rgba(255, 255, 255, 0.3);
transform: translateY(-50%) scale(1.05);
box-shadow: var(--shadow-xl);
}

.home-btn:active {
transform: translateY(-50%) scale(0.95);
}

.header h1 {
color: white;
font-size: 3.5em;
font-weight: 800;
margin-bottom: 15px;
text-shadow: 0 4px 8px rgba(0,0,0,0.2);
letter-spacing: -1px;
position: relative;
z-index: 1;
}

.header p {
color: rgba(255,255,255,0.9);
font-size: 1.2em;
font-weight: 400;
position: relative;
z-index: 1;
}

.form-container {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(20px);
-webkit-backdrop-filter: blur(20px);
border-radius: 30px;
padding: 40px;
box-shadow: var(--shadow-2xl);
margin-bottom: 40px;
border: 1px solid rgba(255, 255, 255, 0.3);
position: relative;
overflow: hidden;
}

.form-container::before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
height: 4px;
background: var(--primary-gradient);
}

.form-header {
display: flex;
align-items: center;
gap: 20px;
margin-bottom: 35px;
padding-bottom: 25px;
border-bottom: 2px solid rgba(0,0,0,0.05);
}

.form-header h2 {
color: var(--text-primary);
font-size: 1.8em;
font-weight: 700;
margin: 0;
}

.form-icon {
width: 56px;
height: 56px;
background: var(--primary-gradient);
border-radius: 16px;
display: flex;
align-items: center;
justify-content: center;
color: white;
box-shadow: var(--shadow-lg);
}

.form-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
gap: 30px;
margin-bottom: 35px;
}

.form-group {
display: flex;
flex-direction: column;
position: relative;
}

label {
font-weight: 600;
color: var(--text-secondary);
margin-bottom: 12px;
font-size: 0.95em;
display: flex;
align-items: center;
gap: 10px;
}

label svg {
width: 20px;
height: 20px;
color: var(--accent-color);
}

input[type="text"],
input[type="file"],
input[type="date"],
textarea {
padding: 16px 20px;
border: 2px solid var(--border-color);
border-radius: 16px;
font-size: 1em;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
font-family: inherit;
background: var(--bg-primary);
}

textarea {
resize: vertical;
min-height: 100px;
}

input[type="text"]:focus,
input[type="date"]:focus,
textarea:focus {
outline: none;
border-color: var(--accent-color);
box-shadow: 0 0 0 4px rgba(49, 130, 206, 0.1);
background: var(--bg-primary);
}

input[type="file"] {
cursor: pointer;
background: rgba(49, 130, 206, 0.05);
}

.button-group {
display: flex;
gap: 20px;
justify-content: center;
flex-wrap: wrap;
}

.action-btn {
display: flex;
align-items: center;
justify-content: center;
gap: 12px;
padding: 18px 36px;
border: none;
border-radius: 16px;
font-size: 1.05em;
font-weight: 600;
cursor: pointer;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
box-shadow: var(--shadow-lg);
position: relative;
overflow: hidden;
}

.action-btn::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
transition: left 0.5s;
}

.action-btn:hover::before {
left: 100%;
}

.action-btn:hover {
transform: translateY(-3px);
box-shadow: var(--shadow-xl);
}

.action-btn:active {
transform: translateY(-1px);
}

.btn-png {
background: var(--danger-gradient);
color: white;
}

.btn-jpg {
background: var(--success-gradient);
color: white;
}

.btn-pdf {
background: var(--info-gradient);
color: white;
}

.btn-edit {
background: var(--warning-gradient);
color: white;
}

.btn-share {
background: var(--accent-gradient);
color: white;
}

.card-preview {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(20px);
-webkit-backdrop-filter: blur(20px);
border-radius: 30px;
padding: 40px;
box-shadow: var(--shadow-2xl);
display: flex;
flex-direction: column;
align-items: center;
border: 1px solid rgba(255, 255, 255, 0.3);
position: relative;
overflow: hidden;
}

.card-preview::before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
height: 4px;
background: var(--accent-gradient);
}

.preview-label {
font-size: 1.5em;
font-weight: 700;
color: var(--text-primary);
margin-bottom: 30px;
display: flex;
align-items: center;
gap: 15px;
}

.card-wrapper {
display: flex;
justify-content: center;
overflow-x: auto;
width: 100%;
padding: 20px;
}

#photoCard {
width: 1080px;
height: 1350px;
min-width: 1080px;
min-height: 1350px;
max-width: 1080px;
max-height: 1350px;
position: relative;
overflow: hidden;
box-shadow: var(--shadow-2xl);
border-radius: 20px;
background-color: #8B1F2C;
transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

#photoCard:hover {
transform: scale(1.02);
}

.template-layer {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-image: url('eveningtemplat.jpg');
background-size: cover;
background-position: center;
background-repeat: no-repeat;
z-index: 1;
transition: filter 0.3s;
}

.big-photo-layer {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
z-index: 2;
display: flex;
align-items: center;
justify-content: center;
overflow: hidden;
}

.big-photo-image {
width: 100%;
height: 100%;
object-fit: cover;
display: block;
position: absolute;
top: 0;
left: 0;
}

.big-photo-placeholder {
color: #8B1F2C;
font-size: 24px;
font-weight: bold;
text-align: center;
z-index: 1;
display: none;
}

.content-wrapper {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
z-index: 3;
}

.card-element {
position: absolute;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.photo-container {
width: 361px;
height: 364px;
background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
border-radius: 20px;
overflow: hidden;
display: flex;
align-items: center;
justify-content: center;
box-shadow: var(--shadow-xl);
position: absolute;
z-index: 3;
border: 3px solid rgba(255, 255, 255, 0.3);
}

.photo-container img {
width: 100%;
height: 100%;
object-fit: cover;
}

.photo-placeholder {
color: var(--text-muted);
font-size: 22px;
font-weight: 500;
}

.card-name {
text-align: center;
white-space: pre-wrap;
}

.card-name .name-text {
font-family: 'Space Grotesk', sans-serif;
font-size: 40px;
font-weight: 700;
color: white;
text-shadow: 0 4px 8px rgba(0,0,0,0.3);
margin: 0;
word-wrap: break-word;
white-space: pre-wrap;
}

.card-subtitle {
text-align: center;
}

.card-subtitle .subtitle-text {
font-family: 'Plus Jakarta Sans', sans-serif;
font-weight: 500;
color: white;
text-shadow: 0 4px 8px rgba(0,0,0,0.3);
margin: 0;
font-size: 32px;
}

.card-number {
text-align: center;
}

.card-number .number-text {
font-family: 'Plus Jakarta Sans', sans-serif;
font-weight: 600;
color: white;
text-shadow: 0 4px 8px rgba(0,0,0,0.3);
margin: 0;
}

/* Modal Styles */
.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.7);
backdrop-filter: blur(10px);
-webkit-backdrop-filter: blur(10px);
z-index: 1000;
overflow-y: auto;
animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
from { opacity: 0; }
to { opacity: 1; }
}

.modal.active {
display: flex;
align-items: center;
justify-content: flex-start;
padding: 20px;
}

.modal-content {
background: rgba(255, 255, 255, 0.98);
backdrop-filter: blur(20px);
-webkit-backdrop-filter: blur(20px);
border-radius: 30px;
box-shadow: var(--shadow-2xl);
width: 450px;
margin: 20px;
overflow: hidden;
border: 1px solid rgba(255, 255, 255, 0.3);
animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
from { 
opacity: 0;
transform: translateX(-50px);
}
to { 
opacity: 1;
transform: translateX(0);
}
}

.modal-left {
background: var(--bg-secondary);
padding: 40px;
overflow-y: auto;
max-height: 90vh;
}

.modal h2 {
margin-bottom: 30px;
color: var(--text-primary);
font-size: 1.8em;
font-weight: 700;
display: flex;
align-items: center;
gap: 12px;
}

.modal h2::before {
content: 'üé®';
font-size: 1.2em;
}

.edit-section {
margin-bottom: 30px;
padding-bottom: 25px;
border-bottom: 2px solid var(--border-color);
}

.edit-section:last-child {
border-bottom: none;
}

.edit-section h3 {
color: var(--text-primary);
margin-bottom: 20px;
font-size: 1.2em;
font-weight: 600;
display: flex;
align-items: center;
gap: 12px;
}

.edit-control {
margin-bottom: 20px;
}

.edit-control label {
display: block;
margin-bottom: 10px;
color: var(--text-secondary);
font-weight: 600;
font-size: 0.9em;
}

.edit-control input[type="range"],
.edit-control select {
width: 100%;
padding: 12px 16px;
border: 2px solid var(--border-color);
border-radius: 12px;
font-size: 1em;
transition: all 0.3s;
background: var(--bg-primary);
}

.edit-control select {
cursor: pointer;
}

.edit-control select:focus {
outline: none;
border-color: var(--accent-color);
box-shadow: 0 0 0 4px rgba(49, 130, 206, 0.1);
}

.edit-control input[type="range"] {
padding: 0;
height: 8px;
cursor: pointer;
background: linear-gradient(to right, var(--accent-color) 0%, var(--accent-color) var(--value), var(--border-color) var(--value), var(--border-color) 100%);
}

.edit-control input[type="file"] {
width: 100%;
padding: 12px 16px;
border: 2px solid var(--border-color);
border-radius: 12px;
font-size: 1em;
transition: all 0.3s;
cursor: pointer;
background: rgba(49, 130, 206, 0.05);
}

.range-value {
display: inline-block;
margin-left: 10px;
font-weight: 700;
color: var(--accent-color);
background: rgba(49, 130, 206, 0.1);
padding: 4px 12px;
border-radius: 8px;
font-size: 0.9em;
}

.modal-buttons {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 15px;
margin-top: 30px;
}

.modal-btn {
padding: 16px;
border: none;
border-radius: 12px;
font-size: 1.05em;
font-weight: 600;
cursor: pointer;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
position: relative;
overflow: hidden;
display: flex;
align-items: center;
justify-content: center;
gap: 8px;
}

.modal-btn::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
transition: left 0.5s;
}

.modal-btn:hover::before {
left: 100%;
}

.modal-btn-save {
background: var(--success-gradient);
color: white;
grid-column: span 2;
}

.modal-btn-save:hover {
transform: translateY(-2px);
box-shadow: var(--shadow-xl);
}

.modal-btn-cancel {
background: var(--secondary-gradient);
color: white;
}

.modal-btn-cancel:hover {
transform: translateY(-2px);
box-shadow: var(--shadow-xl);
}

.modal-btn-undo {
background: var(--info-gradient);
color: white;
}

.modal-btn-undo:hover {
transform: translateY(-2px);
box-shadow: var(--shadow-xl);
}

.modal-btn-reset {
background: var(--danger-gradient);
color: white;
}

.modal-btn-reset:hover {
transform: translateY(-2px);
box-shadow: var(--shadow-xl);
}

/* Share Modal */
.share-modal-content {
background: rgba(255, 255, 255, 0.98);
backdrop-filter: blur(20px);
-webkit-backdrop-filter: blur(20px);
border-radius: 30px;
padding: 50px;
max-width: 700px;
width: 90%;
box-shadow: var(--shadow-2xl);
border: 1px solid rgba(255, 255, 255, 0.3);
}

.share-modal-content h2 {
margin-bottom: 20px;
text-align: center;
font-size: 2em;
font-weight: 700;
color: var(--text-primary);
}

.share-modal-content p {
text-align: center;
color: var(--text-muted);
margin-bottom: 40px;
font-size: 1.1em;
}

.share-options {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 20px;
margin-bottom: 30px;
}

.share-btn {
display: flex;
align-items: center;
justify-content: center;
gap: 15px;
padding: 20px;
border: 2px solid var(--border-color);
border-radius: 16px;
background: var(--bg-primary);
cursor: pointer;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
font-weight: 600;
color: var(--text-secondary);
box-shadow: var(--shadow-md);
}

.share-btn:hover {
background: var(--primary-gradient);
color: white;
transform: translateY(-3px);
box-shadow: var(--shadow-xl);
}

.share-btn svg {
width: 28px;
height: 28px;
}

@media (max-width: 768px) {
.header h1 {
font-size: 2em;
}

.form-container {
padding: 30px 20px;
}

.button-group {
flex-direction: column;
}

.action-btn {
width: 100%;
}

#photoCard {
transform: scale(0.4);
transform-origin: top center;
}

.modal-content {
width: 100%;
max-width: 100%;
margin: 10px;
}

.modal-left {
padding: 30px 20px;
}

.share-options {
grid-template-columns: 1fr;
}
}

.loading {
display: none;
position: fixed;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background: rgba(255, 255, 255, 0.98);
backdrop-filter: blur(20px);
-webkit-backdrop-filter: blur(20px);
padding: 40px 60px;
border-radius: 20px;
box-shadow: var(--shadow-2xl);
z-index: 2000;
text-align: center;
border: 1px solid rgba(255, 255, 255, 0.3);
}

.loading.active {
display: block;
animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
from { 
opacity: 0;
transform: translate(-50%, -40%);
}
to { 
opacity: 1;
transform: translate(-50%, -50%);
}
}

.spinner {
border: 4px solid rgba(49, 130, 206, 0.1);
border-top: 4px solid var(--accent-color);
border-radius: 50%;
width: 60px;
height: 60px;
animation: spin 1s linear infinite;
margin: 0 auto 20px;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

.loading p {
color: var(--text-secondary);
font-weight: 600;
font-size: 1.1em;
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<div class="header-content">
<button class="home-btn" onclick="goHome()">
<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
</button>
<h1>‚ú® Photo Card Generator</h1>
<p>Create stunning photo cards for AHSAN | SRDB - Al Hidaya Students' Association</p>
</div>
</div>

<div class="form-container">
<div class="form-header">
<div class="form-icon">
<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
<circle cx="12" cy="13" r="4"></circle>
</svg>
</div>
<h2>Card Information</h2>
</div>

<div class="form-grid">
<div class="form-group">
<label>
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
<circle cx="12" cy="7" r="4"></circle>
</svg>
Name
</label>
<textarea id="nameInput" placeholder="Enter name here..."></textarea>
</div>

<div class="form-group">
<label>
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
<line x1="9" y1="9" x2="15" y2="9"></line>
<line x1="9" y1="15" x2="15" y2="15"></line>
</svg>
Subtitle
</label>
<input type="text" id="subtitleInput" placeholder="Enter subtitle..." value="">
</div>

<div class="form-group">
<label>
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
<line x1="16" y1="2" x2="16" y2="6"></line>
<line x1="8" y1="2" x2="8" y2="6"></line>
<line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
Number (Day)
</label>
<input type="text" id="numberInput" placeholder="Enter day number..." value="">
</div>

<div class="form-group">
<label>
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
<circle cx="8.5" cy="8.5" r="1.5"></circle>
<polyline points="21 15 16 10 5 21"></polyline>
</svg>
Upload Photo
</label>
<input type="file" id="photoInput" accept="image/*">
</div>
</div>

<div class="button-group">
<button class="action-btn btn-png" onclick="downloadPNG()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
<polyline points="7 10 12 15 17 10"></polyline>
<line x1="12" y1="15" x2="12" y2="3"></line>
</svg>
Download PNG
</button>
<button class="action-btn btn-jpg" onclick="downloadJPG()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
<polyline points="7 10 12 15 17 10"></polyline>
<line x1="12" y1="15" x2="12" y2="3"></line>
</svg>
Download JPG
</button>
<button class="action-btn btn-pdf" onclick="downloadPDF()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
<polyline points="14 2 14 8 20 8"></polyline>
</svg>
Download PDF
</button>
<button class="action-btn btn-edit" onclick="openEditModal()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
<path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
</svg>
Customize
</button>
<button class="action-btn btn-share" onclick="openShareModal()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<circle cx="18" cy="5" r="3"></circle>
<circle cx="6" cy="12" r="3"></circle>
<circle cx="18" cy="19" r="3"></circle>
<line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
<line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
</svg>
Share
</button>
</div>
</div>

<div class="card-preview">
<div class="preview-label">
<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<circle cx="12" cy="12" r="10"></circle>
<circle cx="12" cy="12" r="3"></circle>
</svg>
Live Card Preview
</div>
<div class="card-wrapper">
<div id="photoCard">
<div class="template-layer" id="templateLayer"></div>
<div class="big-photo-layer" id="bigPhotoLayer">
<div class="big-photo-placeholder" id="bigPhotoPlaceholder">Big Photo Area</div>
<img class="big-photo-image" id="bigPhotoImage" src="evening.jpg" style="display: block;">
</div>
<div class="content-wrapper" id="contentWrapper">
<div class="photo-container card-element" id="photoContainer">
<div class="photo-placeholder" id="photoPlaceholder">Upload Photo</div>
<img id="photoImg" style="display: none;">
</div>
<div class="card-name card-element" id="cardName">
<p class="name-text">MINHAJ PADIKKAL</p>
</div>
<div class="card-subtitle card-element" id="cardSubtitle">
<p class="subtitle-text">Talk on Constitution</p>
</div>
<div class="card-number card-element" id="cardNumber">
<p class="number-text">26</p>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Edit Modal -->
<div class="modal" id="editModal">
<div class="modal-content">
<div class="modal-left">
<h2>Customize Card</h2>

<div class="edit-section">
<h3>üé® Template Settings</h3>
<div class="edit-control">
<label>Hue: <span class="range-value" id="templateHueValue">0¬∞</span></label>
<input type="range" id="templateHue" min="0" max="360" value="0" oninput="updateTemplateHue(this.value)">
</div>
</div>

<div class="edit-section">
<h3>üì¶ Big Photo Settings</h3>
<div class="edit-control">
<label>Image Hue: <span class="range-value" id="bigPhotoHueValue">0¬∞</span></label>
<input type="range" id="bigPhotoHue" min="0" max="360" value="0" oninput="updateBigPhotoHue(this.value)">
</div>
<div class="edit-control">
<label>Opacity: <span class="range-value" id="bigPhotoOpacityValue">90%</span></label>
<input type="range" id="bigPhotoOpacity" min="0" max="100" value="90" oninput="updateBigPhotoOpacity(this.value)">
</div>
</div>

<div class="edit-section">
<h3>üë§ Name Settings</h3>
<div class="edit-control">
<label>Width: <span class="range-value" id="nameWidthValue">222px</span></label>
<input type="range" id="nameWidth" min="100" max="800" value="222" oninput="updateNameWidth(this.value)">
</div>
<div class="edit-control">
<label>Height: <span class="range-value" id="nameHeightValue">81px</span></label>
<input type="range" id="nameHeight" min="20" max="200" value="81" oninput="updateNameHeight(this.value)">
</div>
<div class="edit-control">
<label>Position X: <span class="range-value" id="namePosXValue">464px</span></label>
<input type="range" id="namePosX" min="0" max="1080" value="440" oninput="updateNamePosition(this.value, 'x')">
</div>
<div class="edit-control">
<label>Position Y: <span class="range-value" id="namePosYValue">966px</span></label>
<input type="range" id="namePosY" min="0" max="1350" value="928" oninput="updateNamePosition(this.value, 'y')">
</div>
<div class="edit-control">
<label>Font Size: <span class="range-value" id="nameFontSizeValue">60px</span></label>
<input type="range" id="nameFontSize" min="10" max="80" value="40" oninput="updateNameFontSize(this.value)">
</div>
<div class="edit-control">
<label>Font Family:</label>
<select id="nameFont" onchange="updateNameFont(this.value)">
<option value="'Space Grotesk', sans-serif" selected>Space Grotesk</option>
<option value="'Inter', sans-serif">Inter</option>
<option value="'Plus Jakarta Sans', sans-serif">Plus Jakarta Sans</option>
<option value="'Barlow', sans-serif">Barlow</option>
</select>
</div>
</div>

<div class="edit-section">
<h3>üìù Subtitle Settings</h3>
<div class="edit-control">
<label>Width: <span class="range-value" id="subtitleWidthValue">130px</span></label>
<input type="range" id="subtitleWidth" min="100" max="800" value="130" oninput="updateSubtitleWidth(this.value)">
</div>
<div class="edit-control">
<label>Height: <span class="range-value" id="subtitleHeightValue">43px</span></label>
<input type="range" id="subtitleHeight" min="20" max="200" value="43" oninput="updateSubtitleHeight(this.value)">
</div>
<div class="edit-control">
<label>Position X: <span class="range-value" id="subtitlePosXValue">486px</span></label>
<input type="range" id="subtitlePosX" min="0" max="1080" value="486" oninput="updateSubtitlePosition(this.value, 'x')">
</div>
<div class="edit-control">
<label>Position Y: <span class="range-value" id="subtitlePosYValue">500px</span></label>
<input type="range" id="subtitlePosY" min="0" max="1350" value="500" oninput="updateSubtitlePosition(this.value, 'y')">
</div>
<div class="edit-control">
<label>Font Size: <span class="range-value" id="subtitleFontSizeValue">32px</span></label>
<input type="range" id="subtitleFontSize" min="10" max="60" value="32" oninput="updateSubtitleFontSize(this.value)">
</div>
<div class="edit-control">
<label>Font Family:</label>
<select id="subtitleFont" onchange="updateSubtitleFont(this.value)">
<option value="'Plus Jakarta Sans', sans-serif" selected>Plus Jakarta Sans</option>
<option value="'Inter', sans-serif">Inter</option>
<option value="'Space Grotesk', sans-serif">Space Grotesk</option>
<option value="'Barlow', sans-serif">Barlow</option>
</select>
</div>
</div>

<div class="edit-section">
<h3>üî¢ Number Settings</h3>
<div class="edit-control">
<label>Width: <span class="range-value" id="numberWidthValue">85.62px</span></label>
<input type="range" id="numberWidth" min="50" max="200" value="86" oninput="updateNumberWidth(this.value)">
</div>
<div class="edit-control">
<label>Height: <span class="range-value" id="numberHeightValue">100.16px</span></label>
<input type="range" id="numberHeight" min="50" max="200" value="100" oninput="updateNumberHeight(this.value)">
</div>
<div class="edit-control">
<label>Position X: <span class="range-value" id="numberPosXValue">464.66px</span></label>
<input type="range" id="numberPosX" min="0" max="1080" value="464.66" oninput="updateNumberPosition(this.value, 'x')">
</div>
<div class="edit-control">
<label>Position Y: <span class="range-value" id="numberPosYValue">1075px</span></label>
<input type="range" id="numberPosY" min="0" max="1350" value="1075" oninput="updateNumberPosition(this.value, 'y')">
</div>
<div class="edit-control">
<label>Font Size: <span class="range-value" id="numberFontSizeValue">60px</span></label>
<input type="range" id="numberFontSize" min="10" max="80" value="60" oninput="updateNumberFontSize(this.value)">
</div>
<div class="edit-control">
<label>Font Family:</label>
<select id="numberFont" onchange="updateNumberFont(this.value)">
<option value="'Plus Jakarta Sans', sans-serif" selected>Plus Jakarta Sans</option>
<option value="'Inter', sans-serif">Inter</option>
<option value="'Space Grotesk', sans-serif">Space Grotesk</option>
<option value="'Barlow', sans-serif">Barlow</option>
</select>
</div>
</div>

<div class="edit-section">
<h3>üñºÔ∏è Photo Frame</h3>
<div class="edit-control">
<label>Width: <span class="range-value" id="photoWidthValue">318px</span></label>
<input type="range" id="photoWidth" min="100" max="600" value="318" oninput="updatePhotoWidth(this.value)">
</div>
<div class="edit-control">
<label>Height: <span class="range-value" id="photoHeightValue">357px</span></label>
<input type="range" id="photoHeight" min="100" max="600" value="357" oninput="updatePhotoHeight(this.value)">
</div>
<div class="edit-control">
<label>Position X: <span class="range-value" id="photoPosXValue">392px</span></label>
<input type="range" id="photoPosX" min="0" max="1080" value="392" oninput="updatePhotoPosition(this.value, 'x')">
</div>
<div class="edit-control">
<label>Position Y: <span class="range-value" id="photoPosYValue">582px</span></label>
<input type="range" id="photoPosY" min="0" max="1350" value="598" oninput="updatePhotoPosition(this.value, 'y')">
</div>
<div class="edit-control">
<label>Border Radius: <span class="range-value" id="photoRadiusValue">10px</span></label>
<input type="range" id="photoRadius" min="0" max="100" value="10" oninput="updatePhotoRadius(this.value)">
</div>
</div>

<div class="modal-buttons">
<button class="modal-btn modal-btn-undo" onclick="undoChanges()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M3 7v6h6"></path>
<path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"></path>
</svg>
Undo
</button>
<button class="modal-btn modal-btn-reset" onclick="resetToDefaults()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M1 4v6h6"></path>
<path d="M23 20a9 9 0 01-9-9 9 9 0 00-9-9 9 9 0 00-6 2.3L1 10"></path>
</svg>
Reset
</button>
<button class="modal-btn modal-btn-cancel" onclick="cancelEditModal()">‚úï Cancel</button>
<button class="modal-btn modal-btn-save" onclick="closeEditModal()">‚úì Save Changes</button>
</div>
</div>
</div>
</div>

<!-- Share Modal -->
<div class="modal" id="shareModal">
<div class="share-modal-content">
<h2>üì§ Share Your Card</h2>
<p>Download and share your beautiful photo card</p>

<div class="share-options">
<button class="share-btn" onclick="shareAsPNG()">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
<polyline points="7 10 12 15 17 10"></polyline>
<line x1="12" y1="15" x2="12" y2="3"></line>
</svg>
PNG Image
</button>
<button class="share-btn" onclick="shareAsJPG()">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
<polyline points="7 10 12 15 17 10"></polyline>
<line x1="12" y1="15" x2="12" y2="3"></line>
</svg>
JPG Image
</button>
<button class="share-btn" onclick="copyToClipboard()">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
</svg>
Copy Image
</button>
<button class="share-btn" onclick="shareOnWhatsApp()">
<svg viewBox="0 0 24 24" fill="currentColor">
<path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335 .157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
</svg>
WhatsApp
</button>
</div>

<div class="modal-buttons">
<button class="modal-btn modal-btn-cancel" onclick="closeShareModal()" style="width: 100%;">Close</button>
</div>
</div>
</div>

<!-- Loading Indicator -->
<div class="loading" id="loading">
<div class="spinner"></div>
<p>Generating your card...</p>
</div>

<script>
// JavaScript remains the same
const nameInput = document.getElementById('nameInput');
const subtitleInput = document.getElementById('subtitleInput');
const numberInput = document.getElementById('numberInput');
const photoInput = document.getElementById('photoInput');
const cardName = document.getElementById('cardName');
const cardSubtitle = document.getElementById('cardSubtitle');
const cardNumber = document.getElementById('cardNumber');
const photoContainer = document.getElementById('photoContainer');
const photoPlaceholder = document.getElementById('photoPlaceholder');
const photoImg = document.getElementById('photoImg');
const templateLayer = document.getElementById('templateLayer');
const bigPhotoLayer = document.getElementById('bigPhotoLayer');
const bigPhotoImage = document.getElementById('bigPhotoImage');
const bigPhotoPlaceholder = document.getElementById('bigPhotoPlaceholder');
const contentWrapper = document.getElementById('contentWrapper');

// Store original values for undo functionality
let history = [];
let historyIndex = -1;

// Store original values for cancel functionality
let originalValues = {
name: nameInput.value,
subtitle: subtitleInput.value,
number: numberInput.value,
nameWidth: 222,
nameHeight: 81,
namePosX: 464,
namePosY: 963,
nameFontSize: 54,
nameFont: "'Space Grotesk', sans-serif",
subtitleWidth: 130,
subtitleHeight: 43,
subtitlePosX: 486,
subtitlePosY: 500,
subtitleFontSize: 32,
subtitleFont: "'Plus Jakarta Sans', sans-serif",
numberWidth: 85.62,
numberHeight: 100.16,
numberPosX: 464.66,
numberPosY: 1075,
numberFontSize: 60,
numberFont: "'Plus Jakarta Sans', sans-serif",
photoWidth: 318,
photoHeight: 357,
photoPosX: 392,
photoPosY: 598,
photoRadius: 10,
templateHue: 0,
bigPhotoHue: 0,
bigPhotoOpacity: 90
};

// Save current state to history
function saveState() {
// Remove any states after current index
history = history.slice(0, historyIndex + 1);
    
// Add current state
const currentState = {
name: nameInput.value,
subtitle: subtitleInput.value,
number: numberInput.value,
nameWidth: parseInt(document.getElementById('nameWidth').value),
nameHeight: parseInt(document.getElementById('nameHeight').value),
namePosX: parseInt(document.getElementById('namePosX').value),
namePosY: parseInt(document.getElementById('namePosY').value),
nameFontSize: parseInt(document.getElementById('nameFontSize').value),
nameFont: document.getElementById('nameFont').value,
subtitleWidth: parseInt(document.getElementById('subtitleWidth').value),
subtitleHeight: parseInt(document.getElementById('subtitleHeight').value),
subtitlePosX: parseInt(document.getElementById('subtitlePosX').value),
subtitlePosY: parseInt(document.getElementById('subtitlePosY').value),
subtitleFontSize: parseInt(document.getElementById('subtitleFontSize').value),
subtitleFont: document.getElementById('subtitleFont').value,
numberWidth: parseInt(document.getElementById('numberWidth').value),
numberHeight: parseInt(document.getElementById('numberHeight').value),
numberPosX: parseInt(document.getElementById('numberPosX').value),
numberPosY: parseInt(document.getElementById('numberPosY').value),
numberFontSize: parseInt(document.getElementById('numberFontSize').value),
numberFont: document.getElementById('numberFont').value,
photoWidth: parseInt(document.getElementById('photoWidth').value),
photoHeight: parseInt(document.getElementById('photoHeight').value),
photoPosX: parseInt(document.getElementById('photoPosX').value),
photoPosY: parseInt(document.getElementById('photoPosY').value),
photoRadius: parseInt(document.getElementById('photoRadius').value),
templateHue: parseInt(document.getElementById('templateHue').value),
bigPhotoHue: parseInt(document.getElementById('bigPhotoHue').value),
bigPhotoOpacity: parseInt(document.getElementById('bigPhotoOpacity').value)
};

history.push(currentState);
historyIndex++;
    
// Limit history to 20 states
if (history.length > 20) {
history.shift();
historyIndex--;
}
}

// Undo changes
function undoChanges() {
if (historyIndex > 0) {
historyIndex--;
restoreState(history[historyIndex]);
}
}

// Restore a state from history
function restoreState(state) {
nameInput.value = state.name;
subtitleInput.value = state.subtitle;
numberInput.value = state.number;

// Name controls
document.getElementById('nameWidth').value = state.nameWidth;
document.getElementById('nameWidthValue').textContent = state.nameWidth + 'px';
document.getElementById('nameHeight').value = state.nameHeight;
document.getElementById('nameHeightValue').textContent = state.nameHeight + 'px';
document.getElementById('namePosX').value = state.namePosX;
document.getElementById('namePosXValue').textContent = state.namePosX + 'px';
document.getElementById('namePosY').value = state.namePosY;
document.getElementById('namePosYValue').textContent = state.namePosY + 'px';
document.getElementById('nameFontSize').value = state.nameFontSize;
document.getElementById('nameFontSizeValue').textContent = state.nameFontSize + 'px';
document.getElementById('nameFont').value = state.nameFont;

// Subtitle controls
document.getElementById('subtitleWidth').value = state.subtitleWidth;
document.getElementById('subtitleWidthValue').textContent = state.subtitleWidth + 'px';
document.getElementById('subtitleHeight').value = state.subtitleHeight;
document.getElementById('subtitleHeightValue').textContent = state.subtitleHeight + 'px';
document.getElementById('subtitlePosX').value = state.subtitlePosX;
document.getElementById('subtitlePosXValue').textContent = state.subtitlePosX + 'px';
document.getElementById('subtitlePosY').value = state.subtitlePosY;
document.getElementById('subtitlePosYValue').textContent = state.subtitlePosY + 'px';
document.getElementById('subtitleFontSize').value = state.subtitleFontSize;
document.getElementById('subtitleFontSizeValue').textContent = state.subtitleFontSize + 'px';
document.getElementById('subtitleFont').value = state.subtitleFont;

// Number controls
document.getElementById('numberWidth').value = state.numberWidth;
document.getElementById('numberWidthValue').textContent = state.numberWidth + 'px';
document.getElementById('numberHeight').value = state.numberHeight;
document.getElementById('numberHeightValue').textContent = state.numberHeight + 'px';
document.getElementById('numberPosX').value = state.numberPosX;
document.getElementById('numberPosXValue').textContent = state.numberPosX + 'px';
document.getElementById('numberPosY').value = state.numberPosY;
document.getElementById('numberPosYValue').textContent = state.numberPosY + 'px';
document.getElementById('numberFontSize').value = state.numberFontSize;
document.getElementById('numberFontSizeValue').textContent = state.numberFontSize + 'px';
document.getElementById('numberFont').value = state.numberFont;

// Photo controls
document.getElementById('photoWidth').value = state.photoWidth;
document.getElementById('photoWidthValue').textContent = state.photoWidth + 'px';
document.getElementById('photoHeight').value = state.photoHeight;
document.getElementById('photoHeightValue').textContent = state.photoHeight + 'px';
document.getElementById('photoPosX').value = state.photoPosX;
document.getElementById('photoPosXValue').textContent = state.photoPosX + 'px';
document.getElementById('photoPosY').value = state.photoPosY;
document.getElementById('photoPosYValue').textContent = state.photoPosY + 'px';
document.getElementById('photoRadius').value = state.photoRadius;
document.getElementById('photoRadiusValue').textContent = state.photoRadius + 'px';

// Template and big photo controls
document.getElementById('templateHue').value = state.templateHue;
document.getElementById('templateHueValue').textContent = state.templateHue + '¬∞';
document.getElementById('bigPhotoHue').value = state.bigPhotoHue;
document.getElementById('bigPhotoHueValue').textContent = state.bigPhotoHue + '¬∞';
document.getElementById('bigPhotoOpacity').value = state.bigPhotoOpacity;
document.getElementById('bigPhotoOpacityValue').textContent = state.bigPhotoOpacity + '%';

// Apply restored values to elements
updateNameDisplay();
updateSubtitleDisplay();
updateNumberDisplay();
updateNameWidth(state.nameWidth);
updateNameHeight(state.nameHeight);
updateNamePosition(state.namePosX, 'x');
updateNamePosition(state.namePosY, 'y');
updateNameFontSize(state.nameFontSize);
updateNameFont(state.nameFont);

updateSubtitleWidth(state.subtitleWidth);
updateSubtitleHeight(state.subtitleHeight);
updateSubtitlePosition(state.subtitlePosX, 'x');
updateSubtitlePosition(state.subtitlePosY, 'y');
updateSubtitleFontSize(state.subtitleFontSize);
updateSubtitleFont(state.subtitleFont);

updateNumberWidth(state.numberWidth);
updateNumberHeight(state.numberHeight);
updateNumberPosition(state.numberPosX, 'x');
updateNumberPosition(state.numberPosY, 'y');
updateNumberFontSize(state.numberFontSize);
updateNumberFont(state.numberFont);

updatePhotoWidth(state.photoWidth);
updatePhotoHeight(state.photoHeight);
updatePhotoPosition(state.photoPosX, 'x');
updatePhotoPosition(state.photoPosY, 'y');
updatePhotoRadius(state.photoRadius);

updateTemplateHue(state.templateHue);
updateBigPhotoHue(state.bigPhotoHue);
updateBigPhotoOpacity(state.bigPhotoOpacity);
}

// Reset to defaults
function resetToDefaults() {
// Default values
const defaultValues = {
name: "",
subtitle: "",
number: "",
nameWidth: 222,
nameHeight: 81,
namePosX: 464,
namePosY: 966,
nameFontSize: 40,
nameFont: "'Space Grotesk', sans-serif",
subtitleWidth: 130,
subtitleHeight: 43,
subtitlePosX: 486,
subtitlePosY: 500,
subtitleFontSize: 32,
subtitleFont: "'Plus Jakarta Sans', sans-serif",
numberWidth: 85.62,
numberHeight: 100.16,
numberPosX: 464.66,
numberPosY: 1075,
numberFontSize: 60,
numberFont: "'Plus Jakarta Sans', sans-serif",
photoWidth: 318,
photoHeight: 357,
photoPosX: 392,
photoPosY: 598,
photoRadius: 10,
templateHue: 0,
bigPhotoHue: 0,
bigPhotoOpacity: 90
};

// Apply default values
restoreState(defaultValues);
saveState();
}

// Initialize card elements with default positions
function initializeCardElements() {
// Set initial positions for all elements
cardName.style.left = originalValues.namePosX + 'px';
cardName.style.top = originalValues.namePosY + 'px';
cardName.style.width = originalValues.nameWidth + 'px';
cardName.style.height = originalValues.nameHeight + 'px';

cardSubtitle.style.left = originalValues.subtitlePosX + 'px';
cardSubtitle.style.top = originalValues.subtitlePosY + 'px';
cardSubtitle.style.width = originalValues.subtitleWidth + 'px';
cardSubtitle.style.height = originalValues.subtitleHeight + 'px';

cardNumber.style.left = originalValues.numberPosX + 'px';
cardNumber.style.top = originalValues.numberPosY + 'px';
cardNumber.style.width = originalValues.numberWidth + 'px';
cardNumber.style.height = originalValues.numberHeight + 'px';

photoContainer.style.left = originalValues.photoPosX + 'px';
photoContainer.style.top = originalValues.photoPosY + 'px';
photoContainer.style.width = originalValues.photoWidth + 'px';
photoContainer.style.height = originalValues.photoHeight + 'px';
photoContainer.style.borderRadius = originalValues.photoRadius + 'px';

// Set initial font styles
const nameText = cardName.querySelector('.name-text');
nameText.style.fontSize = originalValues.nameFontSize + 'px';
nameText.style.fontFamily = originalValues.nameFont;

const subtitleText = cardSubtitle.querySelector('.subtitle-text');
subtitleText.style.fontSize = originalValues.subtitleFontSize + 'px';
subtitleText.style.fontFamily = originalValues.subtitleFont;

const numberText = cardNumber.querySelector('.number-text');
numberText.style.fontSize = originalValues.numberFontSize + 'px';
numberText.style.fontFamily = originalValues.numberFont;
}

// Update name
nameInput.addEventListener('input', updateNameDisplay);

function updateNameDisplay() {
const name = nameInput.value;
const nameText = cardName.querySelector('.name-text');

if (name) {
nameText.textContent = name;
} else {
nameText.textContent = '';
}
}

// Update subtitle
subtitleInput.addEventListener('input', updateSubtitleDisplay);

function updateSubtitleDisplay() {
const subtitle = subtitleInput.value;
const subtitleText = cardSubtitle.querySelector('.subtitle-text');

if (subtitle) {
subtitleText.textContent = subtitle;
} else {
subtitleText.textContent = '';
}
}

// Update number
numberInput.addEventListener('input', updateNumberDisplay);

function updateNumberDisplay() {
const number = numberInput.value;
const numberText = cardNumber.querySelector('.number-text');

if (number) {
numberText.textContent = number;
} else {
numberText.textContent = '';
}
}

// Handle photo upload
photoInput.addEventListener('change', (e) => {
const file = e.target.files[0];
if (file) {
const reader = new FileReader();
reader.onload = (event) => {
photoImg.src = event.target.result;
photoImg.style.display = 'block';
photoPlaceholder.style.display = 'none';
};
reader.readAsDataURL(file);
}
});

function showLoading() {
document.getElementById('loading').classList.add('active');
}

function hideLoading() {
document.getElementById('loading').classList.remove('active');
}

// Create a temporary card for download without filters
function createDownloadCard() {
const card = document.getElementById('photoCard');
const tempCard = card.cloneNode(true);

// Remove filters from template layer
const tempTemplate = tempCard.querySelector('.template-layer');
if (tempTemplate) {
tempTemplate.style.filter = 'none';
}

// Remove filters from big photo image
const tempBigPhotoImage = tempCard.querySelector('.big-photo-image');
if (tempBigPhotoImage) {
tempBigPhotoImage.style.filter = 'none';
}

// Apply background color directly to card
tempCard.style.backgroundColor = '#8B1F2C';

return tempCard;
}

// Download Functions
async function downloadPNG() {
showLoading();
try {
// Create a temporary container
const tempContainer = document.createElement('div');
tempContainer.style.position = 'fixed';
tempContainer.style.top = '-9999px';
tempContainer.style.left = '-9999px';
tempContainer.style.width = '1080px';
tempContainer.style.height = '1350px';
tempContainer.style.overflow = 'hidden';

// Clone card and remove problematic filters
const tempCard = createDownloadCard();
tempContainer.appendChild(tempCard);
document.body.appendChild(tempContainer);

// Wait for images to load
const images = tempCard.querySelectorAll('img');
await Promise.all(Array.from(images).map(img => {
if (img.complete) return Promise.resolve();
return new Promise((resolve, reject) => {
img.onload = resolve;
img.onerror = reject;
setTimeout(resolve, 3000); // Timeout after 3 seconds
});
}));

const canvas = await html2canvas(tempCard, {
width: 1080,
height: 1350,
scale: 2,
backgroundColor: '#8B1F2C',
logging: false,
useCORS: true,
allowTaint: false,
removeContainer: true,
imageTimeout: 10000
});

canvas.toBlob((blob) => {
const url = URL.createObjectURL(blob);
const link = document.createElement('a');
const timestamp = new Date().getTime();
link.download = `photo-card-${timestamp}.png`;
link.href = url;
link.click();
URL.revokeObjectURL(url);
document.body.removeChild(tempContainer);
hideLoading();
}, 'image/png');
} catch (error) {
console.error('Download failed:', error);
hideLoading();
alert('Failed to download PNG. Please try again.');
}
}

async function downloadJPG() {
showLoading();
try {
// Create a temporary container
const tempContainer = document.createElement('div');
tempContainer.style.position = 'fixed';
tempContainer.style.top = '-9999px';
tempContainer.style.left = '-9999px';
tempContainer.style.width = '1080px';
tempContainer.style.height = '1350px';
tempContainer.style.overflow = 'hidden';

// Clone card and remove problematic filters
const tempCard = createDownloadCard();
tempContainer.appendChild(tempCard);
document.body.appendChild(tempContainer);

// Wait for images to load
const images = tempCard.querySelectorAll('img');
await Promise.all(Array.from(images).map(img => {
if (img.complete) return Promise.resolve();
return new Promise((resolve, reject) => {
img.onload = resolve;
img.onerror = reject;
setTimeout(resolve, 3000); // Timeout after 3 seconds
});
}));

const canvas = await html2canvas(tempCard, {
width: 1080,
height: 1350,
scale: 2,
backgroundColor: '#8B1F2C',
logging: false,
useCORS: true,
allowTaint: false,
removeContainer: true,
imageTimeout: 10000
});

canvas.toBlob((blob) => {
const url = URL.createObjectURL(blob);
const link = document.createElement('a');
const timestamp = new Date().getTime();
link.download = `photo-card-${timestamp}.jpg`;
link.href = url;
link.click();
URL.revokeObjectURL(url);
document.body.removeChild(tempContainer);
hideLoading();
}, 'image/jpeg', 0.95);
} catch (error) {
console.error('Download failed:', error);
hideLoading();
alert('Failed to download JPG. Please try again.');
}
}

async function downloadPDF() {
showLoading();
try {
// Create a temporary container
const tempContainer = document.createElement('div');
tempContainer.style.position = 'fixed';
tempContainer.style.top = '-9999px';
tempContainer.style.left = '-9999px';
tempContainer.style.width = '1080px';
tempContainer.style.height = '1350px';
tempContainer.style.overflow = 'hidden';

// Clone card and remove problematic filters
const tempCard = createDownloadCard();
tempContainer.appendChild(tempCard);
document.body.appendChild(tempContainer);

// Wait for images to load
const images = tempCard.querySelectorAll('img');
await Promise.all(Array.from(images).map(img => {
if (img.complete) return Promise.resolve();
return new Promise((resolve, reject) => {
img.onload = resolve;
img.onerror = reject;
setTimeout(resolve, 3000); // Timeout after 3 seconds
});
}));

const canvas = await html2canvas(tempCard, {
width: 1080,
height: 1350,
scale: 2,
backgroundColor: '#8B1F2C',
logging: false,
useCORS: true,
allowTaint: false,
removeContainer: true,
imageTimeout: 10000
});

const imgData = canvas.toDataURL('image/jpeg', 0.95);
const { jsPDF } = window.jspdf;
const pdf = new jsPDF({
orientation: 'portrait',
unit: 'px',
format: [1080, 1350]
});
pdf.addImage(imgData, 'JPEG', 0, 0, 1080, 1350);
const timestamp = new Date().getTime();
pdf.save(`photo-card-${timestamp}.pdf`);
document.body.removeChild(tempContainer);
hideLoading();
} catch (error) {
console.error('Download failed:', error);
hideLoading();
alert('Failed to download PDF. Please try again.');
}
}

// Edit Modal
function openEditModal() {
// Store current values before opening modal
originalValues = {
name: nameInput.value,
subtitle: subtitleInput.value,
number: numberInput.value,
nameWidth: parseInt(document.getElementById('nameWidth').value),
nameHeight: parseInt(document.getElementById('nameHeight').value),
namePosX: parseInt(document.getElementById('namePosX').value),
namePosY: parseInt(document.getElementById('namePosY').value),
nameFontSize: parseInt(document.getElementById('nameFontSize').value),
nameFont: document.getElementById('nameFont').value,
subtitleWidth: parseInt(document.getElementById('subtitleWidth').value),
subtitleHeight: parseInt(document.getElementById('subtitleHeight').value),
subtitlePosX: parseInt(document.getElementById('subtitlePosX').value),
subtitlePosY: parseInt(document.getElementById('subtitlePosY').value),
subtitleFontSize: parseInt(document.getElementById('subtitleFontSize').value),
subtitleFont: document.getElementById('subtitleFont').value,
numberWidth: parseInt(document.getElementById('numberWidth').value),
numberHeight: parseInt(document.getElementById('numberHeight').value),
numberPosX: parseInt(document.getElementById('numberPosX').value),
numberPosY: parseInt(document.getElementById('numberPosY').value),
numberFontSize: parseInt(document.getElementById('numberFontSize').value),
numberFont: document.getElementById('numberFont').value,
photoWidth: parseInt(document.getElementById('photoWidth').value),
photoHeight: parseInt(document.getElementById('photoHeight').value),
photoPosX: parseInt(document.getElementById('photoPosX').value),
photoPosY: parseInt(document.getElementById('photoPosY').value),
photoRadius: parseInt(document.getElementById('photoRadius').value),
templateHue: parseInt(document.getElementById('templateHue').value),
bigPhotoHue: parseInt(document.getElementById('bigPhotoHue').value),
bigPhotoOpacity: parseInt(document.getElementById('bigPhotoOpacity').value)
};

// Save initial state
saveState();

document.getElementById('editModal').classList.add('active');
}

function closeEditModal() {
document.getElementById('editModal').classList.remove('active');
}

function cancelEditModal() {
// Restore original values
nameInput.value = originalValues.name;
subtitleInput.value = originalValues.subtitle;
numberInput.value = originalValues.number;

// Name controls
document.getElementById('nameWidth').value = originalValues.nameWidth;
document.getElementById('nameWidthValue').textContent = originalValues.nameWidth + 'px';
document.getElementById('nameHeight').value = originalValues.nameHeight;
document.getElementById('nameHeightValue').textContent = originalValues.nameHeight + 'px';
document.getElementById('namePosX').value = originalValues.namePosX;
document.getElementById('namePosXValue').textContent = originalValues.namePosX + 'px';
document.getElementById('namePosY').value = originalValues.namePosY;
document.getElementById('namePosYValue').textContent = originalValues.namePosY + 'px';
document.getElementById('nameFontSize').value = originalValues.nameFontSize;
document.getElementById('nameFontSizeValue').textContent = originalValues.nameFontSize + 'px';
document.getElementById('nameFont').value = originalValues.nameFont;

// Subtitle controls
document.getElementById('subtitleWidth').value = originalValues.subtitleWidth;
document.getElementById('subtitleWidthValue').textContent = originalValues.subtitleWidth + 'px';
document.getElementById('subtitleHeight').value = originalValues.subtitleHeight;
document.getElementById('subtitleHeightValue').textContent = originalValues.subtitleHeight + 'px';
document.getElementById('subtitlePosX').value = originalValues.subtitlePosX;
document.getElementById('subtitlePosXValue').textContent = originalValues.subtitlePosX + 'px';
document.getElementById('subtitlePosY').value = originalValues.subtitlePosY;
document.getElementById('subtitlePosYValue').textContent = originalValues.subtitlePosY + 'px';
document.getElementById('subtitleFontSize').value = originalValues.subtitleFontSize;
document.getElementById('subtitleFontSizeValue').textContent = originalValues.subtitleFontSize + 'px';
document.getElementById('subtitleFont').value = originalValues.subtitleFont;

// Number controls
document.getElementById('numberWidth').value = originalValues.numberWidth;
document.getElementById('numberWidthValue').textContent = originalValues.numberWidth + 'px';
document.getElementById('numberHeight').value = originalValues.numberHeight;
document.getElementById('numberHeightValue').textContent = originalValues.numberHeight + 'px';
document.getElementById('numberPosX').value = originalValues.numberPosX;
document.getElementById('numberPosXValue').textContent = originalValues.numberPosX + 'px';
document.getElementById('numberPosY').value = originalValues.numberPosY;
document.getElementById('numberPosYValue').textContent = originalValues.numberPosY + 'px';
document.getElementById('numberFontSize').value = originalValues.numberFontSize;
document.getElementById('numberFontSizeValue').textContent = originalValues.numberFontSize + 'px';
document.getElementById('numberFont').value = originalValues.numberFont;

// Photo controls
document.getElementById('photoWidth').value = originalValues.photoWidth;
document.getElementById('photoWidthValue').textContent = originalValues.photoWidth + 'px';
document.getElementById('photoHeight').value = originalValues.photoHeight;
document.getElementById('photoHeightValue').textContent = originalValues.photoHeight + 'px';
document.getElementById('photoPosX').value = originalValues.photoPosX;
document.getElementById('photoPosXValue').textContent = originalValues.photoPosX + 'px';
document.getElementById('photoPosY').value = originalValues.photoPosY;
document.getElementById('photoPosYValue').textContent = originalValues.photoPosY + 'px';
document.getElementById('photoRadius').value = originalValues.photoRadius;
document.getElementById('photoRadiusValue').textContent = originalValues.photoRadius + 'px';

// Template and big photo controls
document.getElementById('templateHue').value = originalValues.templateHue;
document.getElementById('templateHueValue').textContent = originalValues.templateHue + '¬∞';
document.getElementById('bigPhotoHue').value = originalValues.bigPhotoHue;
document.getElementById('bigPhotoHueValue').textContent = originalValues.bigPhotoHue + '¬∞';
document.getElementById('bigPhotoOpacity').value = originalValues.bigPhotoOpacity;
document.getElementById('bigPhotoOpacityValue').textContent = originalValues.bigPhotoOpacity + '%';

// Apply restored values to elements
updateNameDisplay();
updateSubtitleDisplay();
updateNumberDisplay();
updateNameWidth(originalValues.nameWidth);
updateNameHeight(originalValues.nameHeight);
updateNamePosition(originalValues.namePosX, 'x');
updateNamePosition(originalValues.namePosY, 'y');
updateNameFontSize(originalValues.nameFontSize);
updateNameFont(originalValues.nameFont);

updateSubtitleWidth(originalValues.subtitleWidth);
updateSubtitleHeight(originalValues.subtitleHeight);
updateSubtitlePosition(originalValues.subtitlePosX, 'x');
updateSubtitlePosition(originalValues.subtitlePosY, 'y');
updateSubtitleFontSize(originalValues.subtitleFontSize);
updateSubtitleFont(originalValues.subtitleFont);

updateNumberWidth(originalValues.numberWidth);
updateNumberHeight(originalValues.numberHeight);
updateNumberPosition(originalValues.numberPosX, 'x');
updateNumberPosition(originalValues.numberPosY, 'y');
updateNumberFontSize(originalValues.numberFontSize);
updateNumberFont(originalValues.numberFont);

updatePhotoWidth(originalValues.photoWidth);
updatePhotoHeight(originalValues.photoHeight);
updatePhotoPosition(originalValues.photoPosX, 'x');
updatePhotoPosition(originalValues.photoPosY, 'y');
updatePhotoRadius(originalValues.photoRadius);

updateTemplateHue(originalValues.templateHue);
updateBigPhotoHue(originalValues.bigPhotoHue);
updateBigPhotoOpacity(originalValues.bigPhotoOpacity);

document.getElementById('editModal').classList.remove('active');
}

// Template Settings
function updateTemplateHue(value) {
document.getElementById('templateHueValue').textContent = value + '¬∞';
templateLayer.style.filter = `hue-rotate(${value}deg)`;
}

// Big Photo Settings
function updateBigPhotoHue(value) {
document.getElementById('bigPhotoHueValue').textContent = value + '¬∞';
bigPhotoImage.style.filter = `hue-rotate(${value}deg)`;
}

function updateBigPhotoOpacity(value) {
document.getElementById('bigPhotoOpacityValue').textContent = value + '%';
const opacity = value / 100;
bigPhotoLayer.style.backgroundColor = `rgba(255, 255, 255, ${opacity})`;
}

// Name Settings
function updateNameWidth(value) {
document.getElementById('nameWidthValue').textContent = value + 'px';
cardName.style.width = value + 'px';
saveState();
}

function updateNameHeight(value) {
document.getElementById('nameHeightValue').textContent = value + 'px';
cardName.style.height = value + 'px';
saveState();
}

function updateNamePosition(value, axis) {
if (axis === 'x') {
document.getElementById('namePosXValue').textContent = value + 'px';
cardName.style.left = value + 'px';
} else {
document.getElementById('namePosYValue').textContent = value + 'px';
cardName.style.top = value + 'px';
}
saveState();
}

function updateNameFontSize(value) {
document.getElementById('nameFontSizeValue').textContent = value + 'px';
const nameElement = cardName.querySelector('.name-text');
if (nameElement) nameElement.style.fontSize = value + 'px';
saveState();
}

function updateNameFont(value) {
const nameElement = cardName.querySelector('.name-text');
if (nameElement) nameElement.style.fontFamily = value;
saveState();
}

// Subtitle Settings
function updateSubtitleWidth(value) {
document.getElementById('subtitleWidthValue').textContent = value + 'px';
cardSubtitle.style.width = value + 'px';
saveState();
}

function updateSubtitleHeight(value) {
document.getElementById('subtitleHeightValue').textContent = value + 'px';
cardSubtitle.style.height = value + 'px';
saveState();
}

function updateSubtitlePosition(value, axis) {
if (axis === 'x') {
document.getElementById('subtitlePosXValue').textContent = value + 'px';
cardSubtitle.style.left = value + 'px';
} else {
document.getElementById('subtitlePosYValue').textContent = value + 'px';
cardSubtitle.style.top = value + 'px';
}
saveState();
}

function updateSubtitleFontSize(value) {
document.getElementById('subtitleFontSizeValue').textContent = value + 'px';
const subtitleElement = cardSubtitle.querySelector('.subtitle-text');
if (subtitleElement) subtitleElement.style.fontSize = value + 'px';
saveState();
}

function updateSubtitleFont(value) {
const subtitleElement = cardSubtitle.querySelector('.subtitle-text');
if (subtitleElement) subtitleElement.style.fontFamily = value;
saveState();
}

// Number Settings
function updateNumberWidth(value) {
document.getElementById('numberWidthValue').textContent = value + 'px';
cardNumber.style.width = value + 'px';
saveState();
}

function updateNumberHeight(value) {
document.getElementById('numberHeightValue').textContent = value + 'px';
cardNumber.style.height = value + 'px';
saveState();
}

function updateNumberPosition(value, axis) {
if (axis === 'x') {
document.getElementById('numberPosXValue').textContent = value + 'px';
cardNumber.style.left = value + 'px';
} else {
document.getElementById('numberPosYValue').textContent = value + 'px';
cardNumber.style.top = value + 'px';
}
saveState();
}

function updateNumberFontSize(value) {
document.getElementById('numberFontSizeValue').textContent = value + 'px';
const numberElement = cardNumber.querySelector('.number-text');
if (numberElement) numberElement.style.fontSize = value + 'px';
saveState();
}

function updateNumberFont(value) {
const numberElement = cardNumber.querySelector('.number-text');
if (numberElement) numberElement.style.fontFamily = value;
saveState();
}

// Photo Container Settings
function updatePhotoWidth(value) {
document.getElementById('photoWidthValue').textContent = value + 'px';
photoContainer.style.width = value + 'px';
saveState();
}

function updatePhotoHeight(value) {
document.getElementById('photoHeightValue').textContent = value + 'px';
photoContainer.style.height = value + 'px';
saveState();
}

function updatePhotoPosition(value, axis) {
if (axis === 'x') {
document.getElementById('photoPosXValue').textContent = value + 'px';
photoContainer.style.left = value + 'px';
} else {
document.getElementById('photoPosYValue').textContent = value + 'px';
photoContainer.style.top = value + 'px';
}
saveState();
}

function updatePhotoRadius(value) {
document.getElementById('photoRadiusValue').textContent = value + 'px';
photoContainer.style.borderRadius = value + 'px';
saveState();
}

// Share Modal
function openShareModal() {
document.getElementById('shareModal').classList.add('active');
}

function closeShareModal() {
document.getElementById('shareModal').classList.remove('active');
}

async function shareAsPNG() {
await downloadPNG();
}

async function shareAsJPG() {
await downloadJPG();
}

async function copyToClipboard() {
showLoading();
try {
// Create a temporary container
const tempContainer = document.createElement('div');
tempContainer.style.position = 'fixed';
tempContainer.style.top = '-9999px';
tempContainer.style.left = '-9999px';
tempContainer.style.width = '1080px';
tempContainer.style.height = '1350px';
tempContainer.style.overflow = 'hidden';

// Clone card and remove problematic filters
const tempCard = createDownloadCard();
tempContainer.appendChild(tempCard);
document.body.appendChild(tempContainer);

// Wait for images to load
const images = tempCard.querySelectorAll('img');
await Promise.all(Array.from(images).map(img => {
if (img.complete) return Promise.resolve();
return new Promise((resolve, reject) => {
img.onload = resolve;
img.onerror = reject;
setTimeout(resolve, 3000); // Timeout after 3 seconds
});
}));

const canvas = await html2canvas(tempCard, {
width: 1080,
height: 1350,
scale: 2,
backgroundColor: '#8B1F2C',
logging: false,
useCORS: true,
allowTaint: false,
removeContainer: true,
imageTimeout: 10000
});

canvas.toBlob(async (blob) => {
try {
await navigator.clipboard.write([
new ClipboardItem({ 'image/png': blob })
]);
document.body.removeChild(tempContainer);
hideLoading();
alert('‚úì Image copied to clipboard! You can now paste it anywhere.');
} catch (err) {
document.body.removeChild(tempContainer);
hideLoading();
alert('Could not copy image. Please download instead.');
}
});
} catch (error) {
hideLoading();
alert('Copy failed. Please try downloading image instead.');
}
}

async function shareOnWhatsApp() {
alert('üí° Tip: Download image first, then share it via WhatsApp from your device!');
await downloadPNG();
}

// Home button function
function goHome() {
// Navigate to index.html
window.location.href = 'index.html';
}

// Close modals on outside click
document.getElementById('editModal').addEventListener('click', function(e) {
if (e.target === this) closeEditModal();
});

document.getElementById('shareModal').addEventListener('click', function(e) {
if (e.target === this) closeShareModal();
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
if (e.key === 'Escape') {
closeEditModal();
closeShareModal();
}
});

// Initialize
window.addEventListener('load', () => {
// Set initial values
initializeCardElements();
updateNameDisplay();
updateSubtitleDisplay();
updateNumberDisplay();
});
</script>
</body>
</html>
