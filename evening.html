<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Photo Card Generator - AHSAN | SRDB - Evening</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Anek+Malayalam:wght@400;600;700;800&family=Roboto:wght@400;700&family=Open+Sans:wght@400;700&family=Lato:wght@400;700&family=Montserrat:wght@400;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
@font-face {
font-family: 'Cocogoose Pro';
src: url('CocogoosePro-trial.ttf') format('truetype');
font-weight: normal;
font-style: normal;
}
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
min-height: 100vh;
padding: 20px;
}

.container {
max-width: 1400px;
margin: 0 auto;
}

.header {
text-align: center;
margin-bottom: 30px;
position: relative;
}

.header h1 {
color: white;
font-size: 2.5em;
font-weight: 700;
margin-bottom: 10px;
text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}

.header p {
color: rgba(255,255,255,0.9);
font-size: 1.1em;
}

.home-btn {
position: absolute;
left: 0;
top: 50%;
transform: translateY(-50%);
background: white;
color: #f97316;
border: none;
border-radius: 50%;
width: 50px;
height: 50px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
box-shadow: 0 4px 8px rgba(0,0,0,0.2);
transition: all 0.3s ease;
}

.home-btn:hover {
background: #f97316;
color: white;
transform: translateY(-50%) scale(1.1);
}

.form-container {
background: white;
padding: 35px;
border-radius: 20px;
box-shadow: 0 10px 40px rgba(0,0,0,0.2);
margin-bottom: 30px;
}

.form-header {
display: flex;
align-items: center;
gap: 15px;
margin-bottom: 25px;
padding-bottom: 20px;
border-bottom: 3px solid #f3f4f6;
}

.form-header h2 {
color: #1f2937;
font-size: 1.5em;
margin: 0;
}

.form-icon {
width: 40px;
height: 40px;
background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
border-radius: 10px;
display: flex;
align-items: center;
justify-content: center;
color: white;
}

.form-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
gap: 25px;
margin-bottom: 30px;
}

.form-group {
display: flex;
flex-direction: column;
}

label {
font-weight: 600;
color: #374151;
margin-bottom: 10px;
font-size: 0.95em;
display: flex;
align-items: center;
gap: 8px;
}

label svg {
width: 18px;
height: 18px;
color: #f97316;
}

input[type="text"],
input[type="file"],
input[type="date"],
textarea {
padding: 14px 16px;
border: 2px solid #e5e7eb;
border-radius: 12px;
font-size: 1em;
transition: all 0.3s;
font-family: inherit;
}

textarea {
resize: vertical;
min-height: 80px;
}

input[type="text"]:focus,
input[type="date"]:focus,
textarea:focus {
outline: none;
border-color: #f97316;
box-shadow: 0 0 0 4px rgba(249, 115, 22, 0.1);
}

input[type="file"] {
cursor: pointer;
}

.button-group {
display: flex;
gap: 15px;
justify-content: center;
flex-wrap: wrap;
}

.action-btn {
display: flex;
align-items: center;
justify-content: center;
gap: 10px;
padding: 16px 32px;
border: none;
border-radius: 12px;
font-size: 1.05em;
font-weight: 600;
cursor: pointer;
transition: all 0.3s;
box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.action-btn:hover {
transform: translateY(-2px);
box-shadow: 0 6px 25px rgba(0,0,0,0.15);
}

.action-btn:active {
transform: translateY(0);
}

.btn-png {
background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
color: white;
}

.btn-jpg {
background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
color: white;
}

.btn-pdf {
background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
color: white;
}

.btn-edit {
background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
color: white;
}

.btn-share {
background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
color: white;
}

.card-preview {
background: white;
padding: 30px;
border-radius: 20px;
box-shadow: 0 10px 40px rgba(0,0,0,0.2);
display: flex;
flex-direction: column;
align-items: center;
}

.preview-label {
font-size: 1.3em;
font-weight: 600;
color: #1f2937;
margin-bottom: 20px;
display: flex;
align-items: center;
gap: 10px;
}

.card-wrapper {
display: flex;
justify-content: center;
overflow-x: auto;
width: 100%;
}

#photoCard {
width: 1080px;
height: 1350px;
min-width: 1080px;
min-height: 1350px;
max-width: 1080px;
max-height: 1350px;
position: relative;
overflow: hidden;
box-shadow: 0 15px 50px rgba(0,0,0,0.3);
border-radius: 10px;
background-color: #8B1F2C;
}

.template-layer {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-image: url('eveningtemplat.jpg');
background-size: cover;
background-position: center;
background-repeat: no-repeat;
z-index: 1;
transition: filter 0.3s;
}

.big-photo-layer {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
z-index: 2;
display: flex;
align-items: center;
justify-content: center;
overflow: hidden;
}

.big-photo-image {
width: 100%;
height: 100%;
object-fit: cover;
display: block;
position: absolute;
top: 0;
left: 0;
}

.big-photo-placeholder {
color: #8B1F2C;
font-size: 24px;
font-weight: bold;
text-align: center;
z-index: 1;
display: none;
}

.content-wrapper {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
z-index: 3;
}

.card-element {
position: absolute;
}

.photo-container {
width: 361px;
height: 364px;
background-color: white;
border-radius: 10px;
overflow: hidden;
display: flex;
align-items: center;
justify-content: center;
box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
position: absolute;
z-index: 3;
}

.photo-container img {
width: 100%;
height: 100%;
object-fit: cover;
}

.photo-placeholder {
color: #9ca3af;
font-size: 22px;
font-weight: 500;
}

.card-name {
text-align: center;
white-space: pre-wrap;
}

.card-name .name-text {
font-family: 'Barlow', sans-serif;
font-size: 40px;
font-weight: bold;
color: white;
text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
margin: 0;
word-wrap: break-word;
white-space: pre-wrap;
}

.card-subtitle {
text-align: center;
}

.card-subtitle .subtitle-text {
font-family: 'Poppins', sans-serif;
font-weight: 500;
color: white;
text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
margin: 0;
font-size: 32px;
}

.card-number {
text-align: center;
}

.card-number .number-text {
font-family: 'Poppins', sans-serif;
font-weight: 600;
color: white;
text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
margin: 0;
}

/* Modal Styles */
.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0,0,0,0.5);
z-index: 1000;
overflow-y: auto;
backdrop-filter: blur(5px);
}

.modal.active {
display: flex;
align-items: flex-start;
justify-content: center;
padding: 20px;
}

.modal-content {
background: white;
border-radius: 20px;
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
max-width: 1400px;
width: 100%;
margin: 20px;
display: grid;
grid-template-columns: 1fr 400px;
gap: 0;
overflow: hidden;
}

.modal-left {
padding: 35px;
display: flex;
flex-direction: column;
align-items: center;
justify-content: flex-start;
background: #f9fafb;
overflow-y: auto;
max-height: 90vh;
}

.modal-right {
background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
padding: 35px;
overflow-y: auto;
max-height: 90vh;
}

.modal h2 {
margin-bottom: 25px;
color: #1f2937;
font-size: 1.8em;
}

.preview-label-modal {
font-size: 1.2em;
font-weight: 600;
color: #1f2937;
margin-bottom: 20px;
display: flex;
align-items: center;
gap: 10px;
}

.preview-card {
width: 100%;
max-width: 650px;
background: white;
border-radius: 15px;
box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
overflow: hidden;
}

.preview-container {
width: 100%;
aspect-ratio: 1080 / 1350;
background-color: #8B1F2C;
position: relative;
overflow: hidden;
}

.preview-template {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-image: url('eveningtemplat.jpg');
background-size: cover;
background-position: center;
background-repeat: no-repeat;
z-index: 1;
}

.preview-big-photo {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
z-index: 2;
display: flex;
align-items: center;
justify-content: center;
overflow: hidden;
}

.preview-big-photo-image {
width: 100%;
height: 100%;
object-fit: cover;
display: block;
position: absolute;
top: 0;
left: 0;
}

.preview-big-photo-placeholder {
color: #8B1F2C;
font-size: 18px;
font-weight: bold;
text-align: center;
z-index: 1;
display: none;
}

.preview-content {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
z-index: 3;
}

.edit-section {
margin-bottom: 25px;
padding-bottom: 20px;
border-bottom: 2px solid #cbd5e1;
}

.edit-section:last-child {
border-bottom: none;
}

.edit-section h3 {
color: #1f2937;
margin-bottom: 18px;
font-size: 1.2em;
display: flex;
align-items: center;
gap: 10px;
}

.edit-control {
margin-bottom: 18px;
}

.edit-control label {
display: block;
margin-bottom: 10px;
color: #475569;
font-weight: 600;
font-size: 0.9em;
}

.edit-control input[type="range"],
.edit-control select {
width: 100%;
padding: 10px 12px;
border: 2px solid #cbd5e1;
border-radius: 10px;
font-size: 1em;
transition: all 0.3s;
}

.edit-control select {
cursor: pointer;
background: white;
}

.edit-control select:focus {
outline: none;
border-color: #f97316;
}

.edit-control input[type="range"] {
padding: 0;
height: 8px;
cursor: pointer;
}

.edit-control input[type="file"] {
width: 100%;
padding: 10px 12px;
border: 2px solid #cbd5e1;
border-radius: 10px;
font-size: 1em;
transition: all 0.3s;
cursor: pointer;
}

.range-value {
display: inline-block;
margin-left: 10px;
font-weight: bold;
color: #f97316;
background: rgba(249, 115, 22, 0.1);
padding: 2px 10px;
border-radius: 5px;
}

.modal-buttons {
display: flex;
gap: 15px;
margin-top: 30px;
}

.modal-btn {
flex: 1;
padding: 14px;
border: none;
border-radius: 10px;
font-size: 1.05em;
font-weight: 600;
cursor: pointer;
transition: all 0.3s;
}

.modal-btn-save {
background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
color: white;
}

.modal-btn-save:hover {
transform: translateY(-2px);
box-shadow: 0 6px 20px rgba(22, 163, 74, 0.3);
}

.modal-btn-cancel {
background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
color: white;
}

.modal-btn-cancel:hover {
transform: translateY(-2px);
box-shadow: 0 6px 20px rgba(107, 114, 128, 0.3);
}

.modal-btn-undo {
background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
color: white;
}

.modal-btn-undo:hover {
transform: translateY(-2px);
box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
}

.modal-btn-reset {
background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
color: white;
}

.modal-btn-reset:hover {
transform: translateY(-2px);
box-shadow: 0 6px 20px rgba(239, 68, 68, 0.3);
}

/* Share Modal */
.share-modal-content {
background: white;
border-radius: 20px;
padding: 40px;
max-width: 600px;
width: 90%;
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}

.share-modal-content h2 {
margin-bottom: 15px;
text-align: center;
}

.share-modal-content p {
text-align: center;
color: #6b7280;
margin-bottom: 30px;
}

.share-options {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 15px;
margin-bottom: 25px;
}

.share-btn {
display: flex;
align-items: center;
justify-content: center;
gap: 10px;
padding: 18px;
border: 2px solid #e5e7eb;
border-radius: 12px;
background: white;
cursor: pointer;
transition: all 0.3s;
font-weight: 600;
color: #374151;
}

.share-btn:hover {
background: #f3f4f6;
border-color: #f97316;
transform: translateY(-2px);
box-shadow: 0 4px 15px rgba(249, 115, 22, 0.2);
}

.share-btn svg {
width: 24px;
height: 24px;
}

@media (max-width: 1200px) {
.modal-content {
grid-template-columns: 1fr;
}

.modal-right {
padding-top: 0;
}
}

@media (max-width: 768px) {
.header h1 {
font-size: 1.8em;
}

.form-container {
padding: 25px;
}

.button-group {
flex-direction: column;
}

.action-btn {
width: 100%;
}

#photoCard {
transform: scale(0.5);
transform-origin: top center;
}

.share-options {
grid-template-columns: 1fr;
}
}

.loading {
display: none;
position: fixed;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background: white;
padding: 30px 50px;
border-radius: 15px;
box-shadow: 0 10px 40px rgba(0,0,0,0.3);
z-index: 2000;
text-align: center;
}

.loading.active {
display: block;
}

.spinner {
border: 4px solid #f3f4f6;
border-top: 4px solid #f97316;
border-radius: 50%;
width: 50px;
height: 50px;
animation: spin 1s linear infinite;
margin: 0 auto 15px;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<button class="home-btn" onclick="goHome()">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
</button>
<h1>üì∏ Photo Card Generator</h1>
<p>Create beautiful photo cards for AHSAN | SRDB - Al Hidaya Students' Association</p>
</div>

<div class="form-container">
<div class="form-header">
<div class="form-icon">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
<circle cx="12" cy="13" r="4"></circle>
</svg>
</div>
<h2>Card Information</h2>
</div>

<div class="form-grid">
<div class="form-group">
<label>
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
<circle cx="12" cy="7" r="4"></circle>
</svg>
Name
</label>
<textarea id="nameInput" placeholder=" "></textarea>
</div>

<div class="form-group">
<label>
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
<line x1="9" y1="9" x2="15" y2="9"></line>
<line x1="9" y1="15" x2="15" y2="15"></line>
</svg>
Subtitle
</label>
<input type="text" id="subtitleInput" placeholder="" value="">
</div>

<div class="form-group">
<label>
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
<line x1="16" y1="2" x2="16" y2="6"></line>
<line x1="8" y1="2" x2="8" y2="6"></line>
<line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
Number (Day)
</label>
<input type="text" id="numberInput" placeholder="" value="">
</div>

<div class="form-group">
<label>
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
<circle cx="8.5" cy="8.5" r="1.5"></circle>
<polyline points="21 15 16 10 5 21"></polyline>
</svg>
Upload Photo
</label>
<input type="file" id="photoInput" accept="image/*">
</div>
</div>

<div class="button-group">
<button class="action-btn btn-png" onclick="downloadPNG()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
<polyline points="7 10 12 15 17 10"></polyline>
<line x1="12" y1="15" x2="12" y2="3"></line>
</svg>
Download PNG
</button>
<button class="action-btn btn-jpg" onclick="downloadJPG()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
<polyline points="7 10 12 15 17 10"></polyline>
<line x1="12" y1="15" x2="12" y2="3"></line>
</svg>
Download JPG
</button>
<button class="action-btn btn-pdf" onclick="downloadPDF()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
<polyline points="14 2 14 8 20 8"></polyline>
</svg>
Download PDF
</button>
<button class="action-btn btn-edit" onclick="openEditModal()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
<path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
</svg>
Customize
</button>
<button class="action-btn btn-share" onclick="openShareModal()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<circle cx="18" cy="5" r="3"></circle>
<circle cx="6" cy="12" r="3"></circle>
<circle cx="18" cy="19" r="3"></circle>
<line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
<line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
</svg>
Share
</button>
</div>
</div>

<div class="card-preview">
<div class="preview-label">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<circle cx="12" cy="12" r="10"></circle>
<circle cx="12" cy="12" r="3"></circle>
</svg>
Card Preview
</div>
<div class="card-wrapper">
<div id="photoCard">
<div class="template-layer" id="templateLayer"></div>
<div class="big-photo-layer" id="bigPhotoLayer">
<div class="big-photo-placeholder" id="bigPhotoPlaceholder">Big Photo Area</div>
<img class="big-photo-image" id="bigPhotoImage" src="evening.jpg" style="display: block;">
</div>
<div class="content-wrapper" id="contentWrapper">
<div class="photo-container card-element" id="photoContainer">
<div class="photo-placeholder" id="photoPlaceholder">Upload Photo</div>
<img id="photoImg" style="display: none;">
</div>
<div class="card-name card-element" id="cardName">
<p class="name-text">MINHAJ PADIKKAL</p>
</div>
<div class="card-subtitle card-element" id="cardSubtitle">
<p class="subtitle-text">Talk on Constitution</p>
</div>
<div class="card-number card-element" id="cardNumber">
<p class="number-text">26</p>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Edit Modal -->
<div class="modal" id="editModal">
<div class="modal-content">
<div class="modal-left">
<div class="preview-label-modal">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<circle cx="12" cy="12" r="10"></circle>
<circle cx="12" cy="12" r="3"></circle>
</svg>
Live Preview
</div>
<div class="preview-card">
<div class="preview-container">
<div class="preview-template" id="previewTemplate"></div>
<div class="preview-big-photo" id="previewBigPhoto">
<div class="preview-big-photo-placeholder" id="previewBigPhotoPlaceholder">Big Photo Area</div>
<img class="preview-big-photo-image" id="previewBigPhotoImage" src="evening.jpg" style="display: block;">
</div>
<div class="preview-content" id="previewContent"></div>
</div>
</div>
</div>

<div class="modal-right">
<h2>‚ú® Customize Card</h2>

<div class="edit-section">
<h3>üé® Template Settings</h3>
<div class="edit-control">
<label>Hue: <span class="range-value" id="templateHueValue">0¬∞</span></label>
<input type="range" id="templateHue" min="0" max="360" value="0" oninput="updateTemplateHue(this.value)">
</div>
</div>

<div class="edit-section">
<h3>üì¶ Big Photo (1080x1350)</h3>
<div class="edit-control">
<label>Image Hue: <span class="range-value" id="bigPhotoHueValue">0¬∞</span></label>
<input type="range" id="bigPhotoHue" min="0" max="360" value="0" oninput="updateBigPhotoHue(this.value)">
</div>
<div class="edit-control">
<label>Opacity: <span class="range-value" id="bigPhotoOpacityValue">90%</span></label>
<input type="range" id="bigPhotoOpacity" min="0" max="100" value="90" oninput="updateBigPhotoOpacity(this.value)">
</div>
</div>

<div class="edit-section">
<h3>üë§ Name Settings</h3>
<div class="edit-control">
<label>Width: <span class="range-value" id="nameWidthValue">222px</span></label>
<input type="range" id="nameWidth" min="100" max="800" value="222" oninput="updateNameWidth(this.value)">
</div>
<div class="edit-control">
<label>Height: <span class="range-value" id="nameHeightValue">81px</span></label>
<input type="range" id="nameHeight" min="20" max="200" value="81" oninput="updateNameHeight(this.value)">
</div>
<div class="edit-control">
<label>Position X: <span class="range-value" id="namePosXValue">464px</span></label>
<input type="range" id="namePosX" min="0" max="1080" value="440" oninput="updateNamePosition(this.value, 'x')">
</div>
<div class="edit-control">
<label>Position Y: <span class="range-value" id="namePosYValue">966px</span></label>
<input type="range" id="namePosY" min="0" max="1350" value="928" oninput="updateNamePosition(this.value, 'y')">
</div>
<div class="edit-control">
<label>Font Size: <span class="range-value" id="nameFontSizeValue">60px</span></label>
<input type="range" id="nameFontSize" min="10" max="80" value="40" oninput="updateNameFontSize(this.value)">
</div>
<div class="edit-control">
<label>Font Family:</label>
<select id="nameFont" onchange="updateNameFont(this.value)">
<option value="'Barlow', sans-serif" selected>Barlow</option>
<option value="'Roboto', sans-serif">Roboto</option>
<option value="'Open Sans', sans-serif">Open Sans</option>
<option value="'Lato', sans-serif">Lato</option>
<option value="'Montserrat', sans-serif">Montserrat</option>
<option value="'Poppins', sans-serif">Poppins</option>
</select>
</div>
</div>

<div class="edit-section">
<h3>üìù Subtitle Settings</h3>
<div class="edit-control">
<label>Width: <span class="range-value" id="subtitleWidthValue">130px</span></label>
<input type="range" id="subtitleWidth" min="100" max="800" value="130" oninput="updateSubtitleWidth(this.value)">
</div>
<div class="edit-control">
<label>Height: <span class="range-value" id="subtitleHeightValue">43px</span></label>
<input type="range" id="subtitleHeight" min="20" max="200" value="43" oninput="updateSubtitleHeight(this.value)">
</div>
<div class="edit-control">
<label>Position X: <span class="range-value" id="subtitlePosXValue">486px</span></label>
<input type="range" id="subtitlePosX" min="0" max="1080" value="486" oninput="updateSubtitlePosition(this.value, 'x')">
</div>
<div class="edit-control">
<label>Position Y: <span class="range-value" id="subtitlePosYValue">500px</span></label>
<input type="range" id="subtitlePosY" min="0" max="1350" value="500" oninput="updateSubtitlePosition(this.value, 'y')">
</div>
<div class="edit-control">
<label>Font Size: <span class="range-value" id="subtitleFontSizeValue">32px</span></label>
<input type="range" id="subtitleFontSize" min="10" max="60" value="32" oninput="updateSubtitleFontSize(this.value)">
</div>
<div class="edit-control">
<label>Font Family:</label>
<select id="subtitleFont" onchange="updateSubtitleFont(this.value)">
<option value="'Poppins', sans-serif" selected>Poppins Medium</option>
<option value="'Roboto', sans-serif">Roboto</option>
<option value="'Open Sans', sans-serif">Open Sans</option>
<option value="'Lato', sans-serif">Lato</option>
<option value="'Montserrat', sans-serif">Montserrat</option>
<option value="'Barlow', sans-serif">Barlow</option>
</select>
</div>
</div>

<div class="edit-section">
<h3>üî¢ Number (Day) Settings</h3>
<div class="edit-control">
<label>Width: <span class="range-value" id="numberWidthValue">85.62px</span></label>
<input type="range" id="numberWidth" min="50" max="200" value="86" oninput="updateNumberWidth(this.value)">
</div>
<div class="edit-control">
<label>Height: <span class="range-value" id="numberHeightValue">100.16px</span></label>
<input type="range" id="numberHeight" min="50" max="200" value="100" oninput="updateNumberHeight(this.value)">
</div>
<div class="edit-control">
<label>Position X: <span class="range-value" id="numberPosXValue">464.66px</span></label>
<input type="range" id="numberPosX" min="0" max="1080" value="464.66" oninput="updateNumberPosition(this.value, 'x')">
</div>
<div class="edit-control">
<label>Position Y: <span class="range-value" id="numberPosYValue">1075px</span></label>
<input type="range" id="numberPosY" min="0" max="1350" value="1075" oninput="updateNumberPosition(this.value, 'y')">
</div>
<div class="edit-control">
<label>Font Size: <span class="range-value" id="numberFontSizeValue">60px</span></label>
<input type="range" id="numberFontSize" min="10" max="80" value="60" oninput="updateNumberFontSize(this.value)">
</div>
<div class="edit-control">
<label>Font Family:</label>
<select id="numberFont" onchange="updateNumberFont(this.value)">
<option value="'Poppins', sans-serif" selected>Poppins Semi Bold</option>
<option value="'Roboto', sans-serif">Roboto</option>
<option value="'Open Sans', sans-serif">Open Sans</option>
<option value="'Lato', sans-serif">Lato</option>
<option value="'Montserrat', sans-serif">Montserrat</option>
<option value="'Barlow', sans-serif">Barlow</option>
</select>
</div>
</div>

<div class="edit-section">
<h3>üñºÔ∏è Photo Frame</h3>
<div class="edit-control">
<label>Width: <span class="range-value" id="photoWidthValue">318px</span></label>
<input type="range" id="photoWidth" min="100" max="600" value="318" oninput="updatePhotoWidth(this.value)">
</div>
<div class="edit-control">
<label>Height: <span class="range-value" id="photoHeightValue">357px</span></label>
<input type="range" id="photoHeight" min="100" max="600" value="357" oninput="updatePhotoHeight(this.value)">
</div>
<div class="edit-control">
<label>Position X: <span class="range-value" id="photoPosXValue">392px</span></label>
<input type="range" id="photoPosX" min="0" max="1080" value="392" oninput="updatePhotoPosition(this.value, 'x')">
</div>
<div class="edit-control">
<label>Position Y: <span class="range-value" id="photoPosYValue">582px</span></label>
<input type="range" id="photoPosY" min="0" max="1350" value="598" oninput="updatePhotoPosition(this.value, 'y')">
</div>
<div class="edit-control">
<label>Border Radius: <span class="range-value" id="photoRadiusValue">10px</span></label>
<input type="range" id="photoRadius" min="0" max="100" value="10" oninput="updatePhotoRadius(this.value)">
</div>
</div>

<div class="modal-buttons">
<button class="modal-btn modal-btn-undo" onclick="undoChanges()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M3 7v6h6"></path>
<path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"></path>
</svg>
Undo
</button>
<button class="modal-btn modal-btn-reset" onclick="resetToDefaults()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M1 4v6h6"></path>
<path d="M23 20a9 9 0 01-9-9 9 9 0 00-9-9 9 9 0 00-6 2.3L1 10"></path>
</svg>
Reset
</button>
<button class="modal-btn modal-btn-save" onclick="closeEditModal()">‚úì Save Changes</button>
<button class="modal-btn modal-btn-cancel" onclick="cancelEditModal()">‚úï Cancel</button>
</div>
</div>
</div>
</div>

<!-- Share Modal -->
<div class="modal" id="shareModal">
<div class="share-modal-content">
<h2>üì§ Share Your Card</h2>
<p>Download and share your beautiful photo card</p>

<div class="share-options">
<button class="share-btn" onclick="shareAsPNG()">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
<polyline points="7 10 12 15 17 10"></polyline>
<line x1="12" y1="15" x2="12" y2="3"></line>
</svg>
PNG Image
</button>
<button class="share-btn" onclick="shareAsJPG()">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
<polyline points="7 10 12 15 17 10"></polyline>
<line x1="12" y1="15" x2="12" y2="3"></line>
</svg>
JPG Image
</button>
<button class="share-btn" onclick="copyToClipboard()">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
</svg>
Copy Image
</button>
<button class="share-btn" onclick="shareOnWhatsApp()">
<svg viewBox="0 0 24 24" fill="currentColor">
<path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335 .157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
</svg>
WhatsApp
</button>
</div>

<div class="modal-buttons">
<button class="modal-btn modal-btn-cancel" onclick="closeShareModal()" style="width: 100%;">Close</button>
</div>
</div>
</div>

<!-- Loading Indicator -->
<div class="loading" id="loading">
<div class="spinner"></div>
<p>Generating your card...</p>
</div>

<script>
// Copy all the JavaScript from noon.html but update template references
// (The JavaScript is the same as noon.html, just with different template references)
const nameInput = document.getElementById('nameInput');
const subtitleInput = document.getElementById('subtitleInput');
const numberInput = document.getElementById('numberInput');
const photoInput = document.getElementById('photoInput');
const cardName = document.getElementById('cardName');
const cardSubtitle = document.getElementById('cardSubtitle');
const cardNumber = document.getElementById('cardNumber');
const photoContainer = document.getElementById('photoContainer');
const photoPlaceholder = document.getElementById('photoPlaceholder');
const photoImg = document.getElementById('photoImg');
const templateLayer = document.getElementById('templateLayer');
const bigPhotoLayer = document.getElementById('bigPhotoLayer');
const bigPhotoImage = document.getElementById('bigPhotoImage');
const bigPhotoPlaceholder = document.getElementById('bigPhotoPlaceholder');
const contentWrapper = document.getElementById('contentWrapper');

// Store original values for undo functionality
let history = [];
let historyIndex = -1;

// Store original values for cancel functionality
let originalValues = {
name: nameInput.value,
subtitle: subtitleInput.value,
number: numberInput.value,
nameWidth: 222,
nameHeight: 81,
namePosX: 464,
namePosY: 963,
nameFontSize: 54,
nameFont: "'Barlow', sans-serif",
subtitleWidth: 130,
subtitleHeight: 43,
subtitlePosX: 486,
subtitlePosY: 500,
subtitleFontSize: 32,
subtitleFont: "'Poppins', sans-serif",
numberWidth: 85.62,
numberHeight: 100.16,
numberPosX: 464.66,
numberPosY: 1075,
numberFontSize: 60,
numberFont: "'Poppins', sans-serif",
photoWidth: 318,
photoHeight: 357,
photoPosX: 392,
photoPosY: 598,
photoRadius: 10,
templateHue: 0,
bigPhotoHue: 0,
bigPhotoOpacity: 90
};

// Save current state to history
function saveState() {
// Remove any states after current index
history = history.slice(0, historyIndex + 1);
    
// Add current state
const currentState = {
name: nameInput.value,
subtitle: subtitleInput.value,
number: numberInput.value,
nameWidth: parseInt(document.getElementById('nameWidth').value),
nameHeight: parseInt(document.getElementById('nameHeight').value),
namePosX: parseInt(document.getElementById('namePosX').value),
namePosY: parseInt(document.getElementById('namePosY').value),
nameFontSize: parseInt(document.getElementById('nameFontSize').value),
nameFont: document.getElementById('nameFont').value,
subtitleWidth: parseInt(document.getElementById('subtitleWidth').value),
subtitleHeight: parseInt(document.getElementById('subtitleHeight').value),
subtitlePosX: parseInt(document.getElementById('subtitlePosX').value),
subtitlePosY: parseInt(document.getElementById('subtitlePosY').value),
subtitleFontSize: parseInt(document.getElementById('subtitleFontSize').value),
subtitleFont: document.getElementById('subtitleFont').value,
numberWidth: parseInt(document.getElementById('numberWidth').value),
numberHeight: parseInt(document.getElementById('numberHeight').value),
numberPosX: parseInt(document.getElementById('numberPosX').value),
numberPosY: parseInt(document.getElementById('numberPosY').value),
numberFontSize: parseInt(document.getElementById('numberFontSize').value),
numberFont: document.getElementById('numberFont').value,
photoWidth: parseInt(document.getElementById('photoWidth').value),
photoHeight: parseInt(document.getElementById('photoHeight').value),
photoPosX: parseInt(document.getElementById('photoPosX').value),
photoPosY: parseInt(document.getElementById('photoPosY').value),
photoRadius: parseInt(document.getElementById('photoRadius').value),
templateHue: parseInt(document.getElementById('templateHue').value),
bigPhotoHue: parseInt(document.getElementById('bigPhotoHue').value),
bigPhotoOpacity: parseInt(document.getElementById('bigPhotoOpacity').value)
};

history.push(currentState);
historyIndex++;
    
// Limit history to 20 states
if (history.length > 20) {
history.shift();
historyIndex--;
}
}

// Undo changes
function undoChanges() {
if (historyIndex > 0) {
historyIndex--;
restoreState(history[historyIndex]);
}
}

// Restore a state from history
function restoreState(state) {
nameInput.value = state.name;
subtitleInput.value = state.subtitle;
numberInput.value = state.number;

// Name controls
document.getElementById('nameWidth').value = state.nameWidth;
document.getElementById('nameWidthValue').textContent = state.nameWidth + 'px';
document.getElementById('nameHeight').value = state.nameHeight;
document.getElementById('nameHeightValue').textContent = state.nameHeight + 'px';
document.getElementById('namePosX').value = state.namePosX;
document.getElementById('namePosXValue').textContent = state.namePosX + 'px';
document.getElementById('namePosY').value = state.namePosY;
document.getElementById('namePosYValue').textContent = state.namePosY + 'px';
document.getElementById('nameFontSize').value = state.nameFontSize;
document.getElementById('nameFontSizeValue').textContent = state.nameFontSize + 'px';
document.getElementById('nameFont').value = state.nameFont;

// Subtitle controls
document.getElementById('subtitleWidth').value = state.subtitleWidth;
document.getElementById('subtitleWidthValue').textContent = state.subtitleWidth + 'px';
document.getElementById('subtitleHeight').value = state.subtitleHeight;
document.getElementById('subtitleHeightValue').textContent = state.subtitleHeight + 'px';
document.getElementById('subtitlePosX').value = state.subtitlePosX;
document.getElementById('subtitlePosXValue').textContent = state.subtitlePosX + 'px';
document.getElementById('subtitlePosY').value = state.subtitlePosY;
document.getElementById('subtitlePosYValue').textContent = state.subtitlePosY + 'px';
document.getElementById('subtitleFontSize').value = state.subtitleFontSize;
document.getElementById('subtitleFontSizeValue').textContent = state.subtitleFontSize + 'px';
document.getElementById('subtitleFont').value = state.subtitleFont;

// Number controls
document.getElementById('numberWidth').value = state.numberWidth;
document.getElementById('numberWidthValue').textContent = state.numberWidth + 'px';
document.getElementById('numberHeight').value = state.numberHeight;
document.getElementById('numberHeightValue').textContent = state.numberHeight + 'px';
document.getElementById('numberPosX').value = state.numberPosX;
document.getElementById('numberPosXValue').textContent = state.numberPosX + 'px';
document.getElementById('numberPosY').value = state.numberPosY;
document.getElementById('numberPosYValue').textContent = state.numberPosY + 'px';
document.getElementById('numberFontSize').value = state.numberFontSize;
document.getElementById('numberFontSizeValue').textContent = state.numberFontSize + 'px';
document.getElementById('numberFont').value = state.numberFont;

// Photo controls
document.getElementById('photoWidth').value = state.photoWidth;
document.getElementById('photoWidthValue').textContent = state.photoWidth + 'px';
document.getElementById('photoHeight').value = state.photoHeight;
document.getElementById('photoHeightValue').textContent = state.photoHeight + 'px';
document.getElementById('photoPosX').value = state.photoPosX;
document.getElementById('photoPosXValue').textContent = state.photoPosX + 'px';
document.getElementById('photoPosY').value = state.photoPosY;
document.getElementById('photoPosYValue').textContent = state.photoPosY + 'px';
document.getElementById('photoRadius').value = state.photoRadius;
document.getElementById('photoRadiusValue').textContent = state.photoRadius + 'px';

// Template and big photo controls
document.getElementById('templateHue').value = state.templateHue;
document.getElementById('templateHueValue').textContent = state.templateHue + '¬∞';
document.getElementById('bigPhotoHue').value = state.bigPhotoHue;
document.getElementById('bigPhotoHueValue').textContent = state.bigPhotoHue + '¬∞';
document.getElementById('bigPhotoOpacity').value = state.bigPhotoOpacity;
document.getElementById('bigPhotoOpacityValue').textContent = state.bigPhotoOpacity + '%';

// Apply restored values to elements
updateNameDisplay();
updateSubtitleDisplay();
updateNumberDisplay();
updateNameWidth(state.nameWidth);
updateNameHeight(state.nameHeight);
updateNamePosition(state.namePosX, 'x');
updateNamePosition(state.namePosY, 'y');
updateNameFontSize(state.nameFontSize);
updateNameFont(state.nameFont);

updateSubtitleWidth(state.subtitleWidth);
updateSubtitleHeight(state.subtitleHeight);
updateSubtitlePosition(state.subtitlePosX, 'x');
updateSubtitlePosition(state.subtitlePosY, 'y');
updateSubtitleFontSize(state.subtitleFontSize);
updateSubtitleFont(state.subtitleFont);

updateNumberWidth(state.numberWidth);
updateNumberHeight(state.numberHeight);
updateNumberPosition(state.numberPosX, 'x');
updateNumberPosition(state.numberPosY, 'y');
updateNumberFontSize(state.numberFontSize);
updateNumberFont(state.numberFont);

updatePhotoWidth(state.photoWidth);
updatePhotoHeight(state.photoHeight);
updatePhotoPosition(state.photoPosX, 'x');
updatePhotoPosition(state.photoPosY, 'y');
updatePhotoRadius(state.photoRadius);

updateTemplateHue(state.templateHue);
updateBigPhotoHue(state.bigPhotoHue);
updateBigPhotoOpacity(state.bigPhotoOpacity);
}

// Reset to defaults
function resetToDefaults() {
// Default values
const defaultValues = {
name: "",
subtitle: "",
number: "",
nameWidth: 222,
nameHeight: 81,
namePosX: 464,
namePosY: 966,
nameFontSize: 40,
nameFont: "'Barlow', sans-serif",
subtitleWidth: 130,
subtitleHeight: 43,
subtitlePosX: 486,
subtitlePosY: 500,
subtitleFontSize: 32,
subtitleFont: "'Poppins', sans-serif",
numberWidth: 85.62,
numberHeight: 100.16,
numberPosX: 464.66,
numberPosY: 1075,
numberFontSize: 60,
numberFont: "'Poppins', sans-serif",
photoWidth: 318,
photoHeight: 357,
photoPosX: 392,
photoPosY: 598,
photoRadius: 10,
templateHue: 0,
bigPhotoHue: 0,
bigPhotoOpacity: 90
};

// Apply default values
restoreState(defaultValues);
saveState();
}

// Initialize card elements with default positions
function initializeCardElements() {
// Set initial positions for all elements
cardName.style.left = originalValues.namePosX + 'px';
cardName.style.top = originalValues.namePosY + 'px';
cardName.style.width = originalValues.nameWidth + 'px';
cardName.style.height = originalValues.nameHeight + 'px';

cardSubtitle.style.left = originalValues.subtitlePosX + 'px';
cardSubtitle.style.top = originalValues.subtitlePosY + 'px';
cardSubtitle.style.width = originalValues.subtitleWidth + 'px';
cardSubtitle.style.height = originalValues.subtitleHeight + 'px';

cardNumber.style.left = originalValues.numberPosX + 'px';
cardNumber.style.top = originalValues.numberPosY + 'px';
cardNumber.style.width = originalValues.numberWidth + 'px';
cardNumber.style.height = originalValues.numberHeight + 'px';

photoContainer.style.left = originalValues.photoPosX + 'px';
photoContainer.style.top = originalValues.photoPosY + 'px';
photoContainer.style.width = originalValues.photoWidth + 'px';
photoContainer.style.height = originalValues.photoHeight + 'px';
photoContainer.style.borderRadius = originalValues.photoRadius + 'px';

// Set initial font styles
const nameText = cardName.querySelector('.name-text');
nameText.style.fontSize = originalValues.nameFontSize + 'px';
nameText.style.fontFamily = originalValues.nameFont;

const subtitleText = cardSubtitle.querySelector('.subtitle-text');
subtitleText.style.fontSize = originalValues.subtitleFontSize + 'px';
subtitleText.style.fontFamily = originalValues.subtitleFont;

const numberText = cardNumber.querySelector('.number-text');
numberText.style.fontSize = originalValues.numberFontSize + 'px';
numberText.style.fontFamily = originalValues.numberFont;
}

// Update name
nameInput.addEventListener('input', updateNameDisplay);

function updateNameDisplay() {
const name = nameInput.value;
const nameText = cardName.querySelector('.name-text');

if (name) {
nameText.textContent = name;
} else {
nameText.textContent = '';
}
}

// Update subtitle
subtitleInput.addEventListener('input', updateSubtitleDisplay);

function updateSubtitleDisplay() {
const subtitle = subtitleInput.value;
const subtitleText = cardSubtitle.querySelector('.subtitle-text');

if (subtitle) {
subtitleText.textContent = subtitle;
} else {
subtitleText.textContent = '';
}
}

// Update number
numberInput.addEventListener('input', updateNumberDisplay);

function updateNumberDisplay() {
const number = numberInput.value;
const numberText = cardNumber.querySelector('.number-text');

if (number) {
numberText.textContent = number;
} else {
numberText.textContent = '';
}
}

// Handle photo upload
photoInput.addEventListener('change', (e) => {
const file = e.target.files[0];
if (file) {
const reader = new FileReader();
reader.onload = (event) => {
photoImg.src = event.target.result;
photoImg.style.display = 'block';
photoPlaceholder.style.display = 'none';
};
reader.readAsDataURL(file);
}
});

function showLoading() {
document.getElementById('loading').classList.add('active');
}

function hideLoading() {
document.getElementById('loading').classList.remove('active');
}

// Create a temporary card for download without filters
function createDownloadCard() {
const card = document.getElementById('photoCard');
const tempCard = card.cloneNode(true);

// Remove filters from template layer
const tempTemplate = tempCard.querySelector('.template-layer');
if (tempTemplate) {
tempTemplate.style.filter = 'none';
}

// Remove filters from big photo image
const tempBigPhotoImage = tempCard.querySelector('.big-photo-image');
if (tempBigPhotoImage) {
tempBigPhotoImage.style.filter = 'none';
}

// Apply background color directly to card
tempCard.style.backgroundColor = '#8B1F2C';

return tempCard;
}

// Download Functions
async function downloadPNG() {
showLoading();
try {
// Create a temporary container
const tempContainer = document.createElement('div');
tempContainer.style.position = 'fixed';
tempContainer.style.top = '-9999px';
tempContainer.style.left = '-9999px';
tempContainer.style.width = '1080px';
tempContainer.style.height = '1350px';
tempContainer.style.overflow = 'hidden';

// Clone card and remove problematic filters
const tempCard = createDownloadCard();
tempContainer.appendChild(tempCard);
document.body.appendChild(tempContainer);

// Wait for images to load
const images = tempCard.querySelectorAll('img');
await Promise.all(Array.from(images).map(img => {
if (img.complete) return Promise.resolve();
return new Promise((resolve, reject) => {
img.onload = resolve;
img.onerror = reject;
setTimeout(resolve, 3000); // Timeout after 3 seconds
});
}));

const canvas = await html2canvas(tempCard, {
width: 1080,
height: 1350,
scale: 2,
backgroundColor: '#8B1F2C',
logging: false,
useCORS: true,
allowTaint: false,
removeContainer: true,
imageTimeout: 10000
});

canvas.toBlob((blob) => {
const url = URL.createObjectURL(blob);
const link = document.createElement('a');
const timestamp = new Date().getTime();
link.download = `photo-card-${timestamp}.png`;
link.href = url;
link.click();
URL.revokeObjectURL(url);
document.body.removeChild(tempContainer);
hideLoading();
}, 'image/png');
} catch (error) {
console.error('Download failed:', error);
hideLoading();
alert('Failed to download PNG. Please try again.');
}
}

async function downloadJPG() {
showLoading();
try {
// Create a temporary container
const tempContainer = document.createElement('div');
tempContainer.style.position = 'fixed';
tempContainer.style.top = '-9999px';
tempContainer.style.left = '-9999px';
tempContainer.style.width = '1080px';
tempContainer.style.height = '1350px';
tempContainer.style.overflow = 'hidden';

// Clone card and remove problematic filters
const tempCard = createDownloadCard();
tempContainer.appendChild(tempCard);
document.body.appendChild(tempContainer);

// Wait for images to load
const images = tempCard.querySelectorAll('img');
await Promise.all(Array.from(images).map(img => {
if (img.complete) return Promise.resolve();
return new Promise((resolve, reject) => {
img.onload = resolve;
img.onerror = reject;
setTimeout(resolve, 3000); // Timeout after 3 seconds
});
}));

const canvas = await html2canvas(tempCard, {
width: 1080,
height: 1350,
scale: 2,
backgroundColor: '#8B1F2C',
logging: false,
useCORS: true,
allowTaint: false,
removeContainer: true,
imageTimeout: 10000
});

canvas.toBlob((blob) => {
const url = URL.createObjectURL(blob);
const link = document.createElement('a');
const timestamp = new Date().getTime();
link.download = `photo-card-${timestamp}.jpg`;
link.href = url;
link.click();
URL.revokeObjectURL(url);
document.body.removeChild(tempContainer);
hideLoading();
}, 'image/jpeg', 0.95);
} catch (error) {
console.error('Download failed:', error);
hideLoading();
alert('Failed to download JPG. Please try again.');
}
}

async function downloadPDF() {
showLoading();
try {
// Create a temporary container
const tempContainer = document.createElement('div');
tempContainer.style.position = 'fixed';
tempContainer.style.top = '-9999px';
tempContainer.style.left = '-9999px';
tempContainer.style.width = '1080px';
tempContainer.style.height = '1350px';
tempContainer.style.overflow = 'hidden';

// Clone card and remove problematic filters
const tempCard = createDownloadCard();
tempContainer.appendChild(tempCard);
document.body.appendChild(tempContainer);

// Wait for images to load
const images = tempCard.querySelectorAll('img');
await Promise.all(Array.from(images).map(img => {
if (img.complete) return Promise.resolve();
return new Promise((resolve, reject) => {
img.onload = resolve;
img.onerror = reject;
setTimeout(resolve, 3000); // Timeout after 3 seconds
});
}));

const canvas = await html2canvas(tempCard, {
width: 1080,
height: 1350,
scale: 2,
backgroundColor: '#8B1F2C',
logging: false,
useCORS: true,
allowTaint: false,
removeContainer: true,
imageTimeout: 10000
});

const imgData = canvas.toDataURL('image/jpeg', 0.95);
const { jsPDF } = window.jspdf;
const pdf = new jsPDF({
orientation: 'portrait',
unit: 'px',
format: [1080, 1350]
});
pdf.addImage(imgData, 'JPEG', 0, 0, 1080, 1350);
const timestamp = new Date().getTime();
pdf.save(`photo-card-${timestamp}.pdf`);
document.body.removeChild(tempContainer);
hideLoading();
} catch (error) {
console.error('Download failed:', error);
hideLoading();
alert('Failed to download PDF. Please try again.');
}
}

// Edit Modal
function openEditModal() {
// Store current values before opening modal
originalValues = {
name: nameInput.value,
subtitle: subtitleInput.value,
number: numberInput.value,
nameWidth: parseInt(document.getElementById('nameWidth').value),
nameHeight: parseInt(document.getElementById('nameHeight').value),
namePosX: parseInt(document.getElementById('namePosX').value),
namePosY: parseInt(document.getElementById('namePosY').value),
nameFontSize: parseInt(document.getElementById('nameFontSize').value),
nameFont: document.getElementById('nameFont').value,
subtitleWidth: parseInt(document.getElementById('subtitleWidth').value),
subtitleHeight: parseInt(document.getElementById('subtitleHeight').value),
subtitlePosX: parseInt(document.getElementById('subtitlePosX').value),
subtitlePosY: parseInt(document.getElementById('subtitlePosY').value),
subtitleFontSize: parseInt(document.getElementById('subtitleFontSize').value),
subtitleFont: document.getElementById('subtitleFont').value,
numberWidth: parseInt(document.getElementById('numberWidth').value),
numberHeight: parseInt(document.getElementById('numberHeight').value),
numberPosX: parseInt(document.getElementById('numberPosX').value),
numberPosY: parseInt(document.getElementById('numberPosY').value),
numberFontSize: parseInt(document.getElementById('numberFontSize').value),
numberFont: document.getElementById('numberFont').value,
photoWidth: parseInt(document.getElementById('photoWidth').value),
photoHeight: parseInt(document.getElementById('photoHeight').value),
photoPosX: parseInt(document.getElementById('photoPosX').value),
photoPosY: parseInt(document.getElementById('photoPosY').value),
photoRadius: parseInt(document.getElementById('photoRadius').value),
templateHue: parseInt(document.getElementById('templateHue').value),
bigPhotoHue: parseInt(document.getElementById('bigPhotoHue').value),
bigPhotoOpacity: parseInt(document.getElementById('bigPhotoOpacity').value)
};

// Save initial state
saveState();

document.getElementById('editModal').classList.add('active');
updatePreview();
}

function closeEditModal() {
document.getElementById('editModal').classList.remove('active');
}

function cancelEditModal() {
// Restore original values
nameInput.value = originalValues.name;
subtitleInput.value = originalValues.subtitle;
numberInput.value = originalValues.number;

// Name controls
document.getElementById('nameWidth').value = originalValues.nameWidth;
document.getElementById('nameWidthValue').textContent = originalValues.nameWidth + 'px';
document.getElementById('nameHeight').value = originalValues.nameHeight;
document.getElementById('nameHeightValue').textContent = originalValues.nameHeight + 'px';
document.getElementById('namePosX').value = originalValues.namePosX;
document.getElementById('namePosXValue').textContent = originalValues.namePosX + 'px';
document.getElementById('namePosY').value = originalValues.namePosY;
document.getElementById('namePosYValue').textContent = originalValues.namePosY + 'px';
document.getElementById('nameFontSize').value = originalValues.nameFontSize;
document.getElementById('nameFontSizeValue').textContent = originalValues.nameFontSize + 'px';
document.getElementById('nameFont').value = originalValues.nameFont;

// Subtitle controls
document.getElementById('subtitleWidth').value = originalValues.subtitleWidth;
document.getElementById('subtitleWidthValue').textContent = originalValues.subtitleWidth + 'px';
document.getElementById('subtitleHeight').value = originalValues.subtitleHeight;
document.getElementById('subtitleHeightValue').textContent = originalValues.subtitleHeight + 'px';
document.getElementById('subtitlePosX').value = originalValues.subtitlePosX;
document.getElementById('subtitlePosXValue').textContent = originalValues.subtitlePosX + 'px';
document.getElementById('subtitlePosY').value = originalValues.subtitlePosY;
document.getElementById('subtitlePosYValue').textContent = originalValues.subtitlePosY + 'px';
document.getElementById('subtitleFontSize').value = originalValues.subtitleFontSize;
document.getElementById('subtitleFontSizeValue').textContent = originalValues.subtitleFontSize + 'px';
document.getElementById('subtitleFont').value = originalValues.subtitleFont;

// Number controls
document.getElementById('numberWidth').value = originalValues.numberWidth;
document.getElementById('numberWidthValue').textContent = originalValues.numberWidth + 'px';
document.getElementById('numberHeight').value = originalValues.numberHeight;
document.getElementById('numberHeightValue').textContent = originalValues.numberHeight + 'px';
document.getElementById('numberPosX').value = originalValues.numberPosX;
document.getElementById('numberPosXValue').textContent = originalValues.numberPosX + 'px';
document.getElementById('numberPosY').value = originalValues.numberPosY;
document.getElementById('numberPosYValue').textContent = originalValues.numberPosY + 'px';
document.getElementById('numberFontSize').value = originalValues.numberFontSize;
document.getElementById('numberFontSizeValue').textContent = originalValues.numberFontSize + 'px';
document.getElementById('numberFont').value = originalValues.numberFont;

// Photo controls
document.getElementById('photoWidth').value = originalValues.photoWidth;
document.getElementById('photoWidthValue').textContent = originalValues.photoWidth + 'px';
document.getElementById('photoHeight').value = originalValues.photoHeight;
document.getElementById('photoHeightValue').textContent = originalValues.photoHeight + 'px';
document.getElementById('photoPosX').value = originalValues.photoPosX;
document.getElementById('photoPosXValue').textContent = originalValues.photoPosX + 'px';
document.getElementById('photoPosY').value = originalValues.photoPosY;
document.getElementById('photoPosYValue').textContent = originalValues.photoPosY + 'px';
document.getElementById('photoRadius').value = originalValues.photoRadius;
document.getElementById('photoRadiusValue').textContent = originalValues.photoRadius + 'px';

// Template and big photo controls
document.getElementById('templateHue').value = originalValues.templateHue;
document.getElementById('templateHueValue').textContent = originalValues.templateHue + '¬∞';
document.getElementById('bigPhotoHue').value = originalValues.bigPhotoHue;
document.getElementById('bigPhotoHueValue').textContent = originalValues.bigPhotoHue + '¬∞';
document.getElementById('bigPhotoOpacity').value = originalValues.bigPhotoOpacity;
document.getElementById('bigPhotoOpacityValue').textContent = originalValues.bigPhotoOpacity + '%';

// Apply restored values to elements
updateNameDisplay();
updateSubtitleDisplay();
updateNumberDisplay();
updateNameWidth(originalValues.nameWidth);
updateNameHeight(originalValues.nameHeight);
updateNamePosition(originalValues.namePosX, 'x');
updateNamePosition(originalValues.namePosY, 'y');
updateNameFontSize(originalValues.nameFontSize);
updateNameFont(originalValues.nameFont);

updateSubtitleWidth(originalValues.subtitleWidth);
updateSubtitleHeight(originalValues.subtitleHeight);
updateSubtitlePosition(originalValues.subtitlePosX, 'x');
updateSubtitlePosition(originalValues.subtitlePosY, 'y');
updateSubtitleFontSize(originalValues.subtitleFontSize);
updateSubtitleFont(originalValues.subtitleFont);

updateNumberWidth(originalValues.numberWidth);
updateNumberHeight(originalValues.numberHeight);
updateNumberPosition(originalValues.numberPosX, 'x');
updateNumberPosition(originalValues.numberPosY, 'y');
updateNumberFontSize(originalValues.numberFontSize);
updateNumberFont(originalValues.numberFont);

updatePhotoWidth(originalValues.photoWidth);
updatePhotoHeight(originalValues.photoHeight);
updatePhotoPosition(originalValues.photoPosX, 'x');
updatePhotoPosition(originalValues.photoPosY, 'y');
updatePhotoRadius(originalValues.photoRadius);

updateTemplateHue(originalValues.templateHue);
updateBigPhotoHue(originalValues.bigPhotoHue);
updateBigPhotoOpacity(originalValues.bigPhotoOpacity);

document.getElementById('editModal').classList.remove('active');
}

function updatePreview() {
const previewContent = document.getElementById('previewContent');
const originalContent = document.querySelector('.content-wrapper');
previewContent.innerHTML = originalContent.innerHTML;

// Apply styles to preview elements
const previewName = previewContent.querySelector('.card-name');
const originalName = originalContent.querySelector('.card-name');
if (previewName && originalName) {
previewName.style.left = originalName.style.left || '464px';
previewName.style.top = originalName.style.top || '966px';
previewName.style.width = originalName.style.width || '222px';
previewName.style.height = originalName.style.height || '81px';

const previewNameText = previewName.querySelector('.name-text');
const originalNameText = originalName.querySelector('.name-text');
if (previewNameText && originalNameText) {
previewNameText.style.fontSize = originalNameText.style.fontSize || '60px';
previewNameText.style.fontFamily = originalNameText.style.fontFamily || "'Barlow', sans-serif";
}
}

const previewSubtitle = previewContent.querySelector('.card-subtitle');
const originalSubtitle = originalContent.querySelector('.card-subtitle');
if (previewSubtitle && originalSubtitle) {
previewSubtitle.style.left = originalSubtitle.style.left || '486px';
previewSubtitle.style.top = originalSubtitle.style.top || '500px';
previewSubtitle.style.width = originalSubtitle.style.width || '130px';
previewSubtitle.style.height = originalSubtitle.style.height || '43px';

const previewSubtitleText = previewSubtitle.querySelector('.subtitle-text');
const originalSubtitleText = originalSubtitle.querySelector('.subtitle-text');
if (previewSubtitleText && originalSubtitleText) {
previewSubtitleText.style.fontSize = originalSubtitleText.style.fontSize || '32px';
previewSubtitleText.style.fontFamily = originalSubtitleText.style.fontFamily || "'Poppins', sans-serif";
}
}

const previewNumber = previewContent.querySelector('.card-number');
const originalNumber = originalContent.querySelector('.card-number');
if (previewNumber && originalNumber) {
previewNumber.style.left = originalNumber.style.left || '464.66px';
previewNumber.style.top = originalNumber.style.top || '1075px';
previewNumber.style.width = originalNumber.style.width || '85.62px';
previewNumber.style.height = originalNumber.style.height || '100.16px';

const previewNumberText = previewNumber.querySelector('.number-text');
const originalNumberText = originalNumber.querySelector('.number-text');
if (previewNumberText && originalNumberText) {
previewNumberText.style.fontSize = originalNumberText.style.fontSize || '60px';
previewNumberText.style.fontFamily = originalNumberText.style.fontFamily || "'Poppins', sans-serif";
}
}

const previewPhoto = previewContent.querySelector('.photo-container');
const originalPhoto = originalContent.querySelector('.photo-container');
if (previewPhoto && originalPhoto) {
previewPhoto.style.left = originalPhoto.style.left || '392px';
previewPhoto.style.top = originalPhoto.style.top || '598px';
previewPhoto.style.width = originalPhoto.style.width || '318px';
previewPhoto.style.height = originalPhoto.style.height || '357px';
previewPhoto.style.borderRadius = originalPhoto.style.borderRadius || '10px';
}

// Apply template hue to preview
const previewTemplate = document.getElementById('previewTemplate');
const originalTemplate = document.getElementById('templateLayer');
if (previewTemplate && originalTemplate) {
previewTemplate.style.filter = originalTemplate.style.filter || 'hue-rotate(0deg)';
}

// Apply big photo image and hue to preview
const previewBigPhoto = document.getElementById('previewBigPhoto');
const previewBigPhotoImage = document.getElementById('previewBigPhotoImage');
const previewBigPhotoPlaceholder = document.getElementById('previewBigPhotoPlaceholder');

if (bigPhotoImage.src && bigPhotoImage.style.display !== 'none') {
previewBigPhotoImage.src = bigPhotoImage.src;
previewBigPhotoImage.style.display = 'block';
previewBigPhotoPlaceholder.style.display = 'none';
previewBigPhotoImage.style.filter = bigPhotoImage.style.filter || 'hue-rotate(0deg)';
previewBigPhoto.style.backgroundColor = bigPhotoLayer.style.backgroundColor || 'rgba(255, 255, 255, 0.9)';
} else {
previewBigPhotoImage.style.display = 'none';
previewBigPhotoPlaceholder.style.display = 'block';
}
}

// Template Settings
function updateTemplateHue(value) {
document.getElementById('templateHueValue').textContent = value + '¬∞';
templateLayer.style.filter = `hue-rotate(${value}deg)`;
updatePreview();
}

// Big Photo Settings
function updateBigPhotoHue(value) {
document.getElementById('bigPhotoHueValue').textContent = value + '¬∞';
bigPhotoImage.style.filter = `hue-rotate(${value}deg)`;
updatePreview();
}

function updateBigPhotoOpacity(value) {
document.getElementById('bigPhotoOpacityValue').textContent = value + '%';
const opacity = value / 100;
bigPhotoLayer.style.backgroundColor = `rgba(255, 255, 255, ${opacity})`;
updatePreview();
}

// Name Settings
function updateNameWidth(value) {
document.getElementById('nameWidthValue').textContent = value + 'px';
cardName.style.width = value + 'px';
saveState();
updatePreview();
}

function updateNameHeight(value) {
document.getElementById('nameHeightValue').textContent = value + 'px';
cardName.style.height = value + 'px';
saveState();
updatePreview();
}

function updateNamePosition(value, axis) {
if (axis === 'x') {
document.getElementById('namePosXValue').textContent = value + 'px';
cardName.style.left = value + 'px';
} else {
document.getElementById('namePosYValue').textContent = value + 'px';
cardName.style.top = value + 'px';
}
saveState();
updatePreview();
}

function updateNameFontSize(value) {
document.getElementById('nameFontSizeValue').textContent = value + 'px';
const nameElement = cardName.querySelector('.name-text');
if (nameElement) nameElement.style.fontSize = value + 'px';
saveState();
updatePreview();
}

function updateNameFont(value) {
const nameElement = cardName.querySelector('.name-text');
if (nameElement) nameElement.style.fontFamily = value;
saveState();
updatePreview();
}

// Subtitle Settings
function updateSubtitleWidth(value) {
document.getElementById('subtitleWidthValue').textContent = value + 'px';
cardSubtitle.style.width = value + 'px';
saveState();
updatePreview();
}

function updateSubtitleHeight(value) {
document.getElementById('subtitleHeightValue').textContent = value + 'px';
cardSubtitle.style.height = value + 'px';
saveState();
updatePreview();
}

function updateSubtitlePosition(value, axis) {
if (axis === 'x') {
document.getElementById('subtitlePosXValue').textContent = value + 'px';
cardSubtitle.style.left = value + 'px';
} else {
document.getElementById('subtitlePosYValue').textContent = value + 'px';
cardSubtitle.style.top = value + 'px';
}
saveState();
updatePreview();
}

function updateSubtitleFontSize(value) {
document.getElementById('subtitleFontSizeValue').textContent = value + 'px';
const subtitleElement = cardSubtitle.querySelector('.subtitle-text');
if (subtitleElement) subtitleElement.style.fontSize = value + 'px';
saveState();
updatePreview();
}

function updateSubtitleFont(value) {
const subtitleElement = cardSubtitle.querySelector('.subtitle-text');
if (subtitleElement) subtitleElement.style.fontFamily = value;
saveState();
updatePreview();
}

// Number Settings
function updateNumberWidth(value) {
document.getElementById('numberWidthValue').textContent = value + 'px';
cardNumber.style.width = value + 'px';
saveState();
updatePreview();
}

function updateNumberHeight(value) {
document.getElementById('numberHeightValue').textContent = value + 'px';
cardNumber.style.height = value + 'px';
saveState();
updatePreview();
}

function updateNumberPosition(value, axis) {
if (axis === 'x') {
document.getElementById('numberPosXValue').textContent = value + 'px';
cardNumber.style.left = value + 'px';
} else {
document.getElementById('numberPosYValue').textContent = value + 'px';
cardNumber.style.top = value + 'px';
}
saveState();
updatePreview();
}

function updateNumberFontSize(value) {
document.getElementById('numberFontSizeValue').textContent = value + 'px';
const numberElement = cardNumber.querySelector('.number-text');
if (numberElement) numberElement.style.fontSize = value + 'px';
saveState();
updatePreview();
}

function updateNumberFont(value) {
const numberElement = cardNumber.querySelector('.number-text');
if (numberElement) numberElement.style.fontFamily = value;
saveState();
updatePreview();
}

// Photo Container Settings
function updatePhotoWidth(value) {
document.getElementById('photoWidthValue').textContent = value + 'px';
photoContainer.style.width = value + 'px';
saveState();
updatePreview();
}

function updatePhotoHeight(value) {
document.getElementById('photoHeightValue').textContent = value + 'px';
photoContainer.style.height = value + 'px';
saveState();
updatePreview();
}

function updatePhotoPosition(value, axis) {
if (axis === 'x') {
document.getElementById('photoPosXValue').textContent = value + 'px';
photoContainer.style.left = value + 'px';
} else {
document.getElementById('photoPosYValue').textContent = value + 'px';
photoContainer.style.top = value + 'px';
}
saveState();
updatePreview();
}

function updatePhotoRadius(value) {
document.getElementById('photoRadiusValue').textContent = value + 'px';
photoContainer.style.borderRadius = value + 'px';
saveState();
updatePreview();
}

// Share Modal
function openShareModal() {
document.getElementById('shareModal').classList.add('active');
}

function closeShareModal() {
document.getElementById('shareModal').classList.remove('active');
}

async function shareAsPNG() {
await downloadPNG();
}

async function shareAsJPG() {
await downloadJPG();
}

async function copyToClipboard() {
showLoading();
try {
// Create a temporary container
const tempContainer = document.createElement('div');
tempContainer.style.position = 'fixed';
tempContainer.style.top = '-9999px';
tempContainer.style.left = '-9999px';
tempContainer.style.width = '1080px';
tempContainer.style.height = '1350px';
tempContainer.style.overflow = 'hidden';

// Clone card and remove problematic filters
const tempCard = createDownloadCard();
tempContainer.appendChild(tempCard);
document.body.appendChild(tempContainer);

// Wait for images to load
const images = tempCard.querySelectorAll('img');
await Promise.all(Array.from(images).map(img => {
if (img.complete) return Promise.resolve();
return new Promise((resolve, reject) => {
img.onload = resolve;
img.onerror = reject;
setTimeout(resolve, 3000); // Timeout after 3 seconds
});
}));

const canvas = await html2canvas(tempCard, {
width: 1080,
height: 1350,
scale: 2,
backgroundColor: '#8B1F2C',
logging: false,
useCORS: true,
allowTaint: false,
removeContainer: true,
imageTimeout: 10000
});

canvas.toBlob(async (blob) => {
try {
await navigator.clipboard.write([
new ClipboardItem({ 'image/png': blob })
]);
document.body.removeChild(tempContainer);
hideLoading();
alert('‚úì Image copied to clipboard! You can now paste it anywhere.');
} catch (err) {
document.body.removeChild(tempContainer);
hideLoading();
alert('Could not copy image. Please download instead.');
}
});
} catch (error) {
hideLoading();
alert('Copy failed. Please try downloading image instead.');
}
}

async function shareOnWhatsApp() {
alert('üí° Tip: Download image first, then share it via WhatsApp from your device!');
await downloadPNG();
}

// Home button function
function goHome() {
// Navigate to home page or reload current page
window.location.href = '/';
}

// Close modals on outside click
document.getElementById('editModal').addEventListener('click', function(e) {
if (e.target === this) closeEditModal();
});

document.getElementById('shareModal').addEventListener('click', function(e) {
if (e.target === this) closeShareModal();
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
if (e.key === 'Escape') {
closeEditModal();
closeShareModal();
}
});

// Initialize
window.addEventListener('load', () => {
// Set initial values
initializeCardElements();
updateNameDisplay();
updateSubtitleDisplay();
updateNumberDisplay();
});
</script>
</body>
</html>
